--[[
    AzureUI v3.1 - Professional UI Library (Fixed & Enhanced)
    Features: Auto-minimizing tabs, compact dropdowns, slider input dialogs,
    gradient color picker, randomized display names, fixed notifications,
    version system, and WindUI-inspired aesthetics.
    
    Toggle Key: K (Changed from RightShift)
]]

local AzureUI = {}
AzureUI.__index = AzureUI

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Version System
AzureUI.Version = "1256" -- User requested version capability
AzureUI.DisplayNames = {
    "Azure", "Spectra", "Nova", "Vortex", "Nebula", "Orbit", 
    "Cipher", "Matrix", "Echo", "Pulse", "Flux", "Prism"
}

-- Icons (Lucide-inspired)
local Icons = {
    ["x"] = "rbxassetid://7733658504",
    ["minus"] = "rbxassetid://7733764353",
    ["home"] = "rbxassetid://7733963888",
    ["settings"] = "rbxassetid://7733973200",
    ["user"] = "rbxassetid://7733970256",
    ["search"] = "rbxassetid://7733955854",
    ["palette"] = "rbxassetid://7733946818",
    ["sliders"] = "rbxassetid://7733970821",
    ["chevron-down"] = "rbxassetid://7733715403",
    ["chevron-right"] = "rbxassetid://7733712849",
    ["chevrons-left"] = "rbxassetid://7733717659",
    ["chevrons-right"] = "rbxassetid://7733942654",
    ["pin"] = "rbxassetid://7733946818",
    ["maximize"] = "rbxassetid://7733954206",
    ["minimize"] = "rbxassetid://7733764353",
    ["bell"] = "rbxassetid://7733673125",
    ["check"] = "rbxassetid://7733710700",
    ["alert-circle"] = "rbxassetid://7733658504",
    ["eye"] = "rbxassetid://7733942654",
    ["eye-off"] = "rbxassetid://7733943256",
    ["lock"] = "rbxassetid://7733940867",
    ["unlock"] = "rbxassetid://7733949600",
    ["command"] = "rbxassetid://7733678066",
    ["zap"] = "rbxassetid://7733992109",
    ["moon"] = "rbxassetid://7733954468",
    ["sun"] = "rbxassetid://7733978098"
}

-- Themes
local Themes = {
    Dark = {
        Background = Color3.fromRGB(18, 18, 22),
        Accent = Color3.fromHex("#5865F2"),
        Secondary = Color3.fromRGB(35, 35, 40),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(180, 180, 190),
        ToggleOn = Color3.fromHex("#5865F2"),
        ToggleOff = Color3.fromRGB(60, 60, 65),
        CornerRadius = UDim.new(0, 12),
        Shadow = Color3.fromRGB(0, 0, 0)
    },
    Midnight = {
        Background = Color3.fromRGB(12, 12, 18),
        Accent = Color3.fromHex("#3b82f6"),
        Secondary = Color3.fromRGB(25, 25, 35),
        Text = Color3.fromRGB(240, 240, 250),
        SubText = Color3.fromRGB(150, 150, 170),
        ToggleOn = Color3.fromHex("#3b82f6"),
        ToggleOff = Color3.fromRGB(45, 45, 55),
        CornerRadius = UDim.new(0, 10),
        Shadow = Color3.fromRGB(0, 0, 5)
    },
    Sirius = { -- Added Sirius-inspired theme
        Background = Color3.fromRGB(20, 20, 25),
        Accent = Color3.fromHex("#6366f1"),
        Secondary = Color3.fromRGB(30, 30, 38),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(160, 160, 170),
        ToggleOn = Color3.fromHex("#6366f1"),
        ToggleOff = Color3.fromRGB(55, 55, 65),
        CornerRadius = UDim.new(0, 8),
        Shadow = Color3.fromRGB(5, 5, 10)
    }
}

local Theme = Themes.Dark

-- Utility Functions
local function Create(instanceType, properties)
    local instance = Instance.new(instanceType)
    for prop, value in pairs(properties or {}) do
        instance[prop] = value
    end
    return instance
end

local function Tween(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(
        duration or 0.3, 
        easingStyle or Enum.EasingStyle.Quart, 
        easingDirection or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

local function GetIcon(iconName)
    return Icons[iconName] or Icons["home"]
end

local function RandomizeName()
    local adj = {"Pro", "Elite", "Ultra", "Max", "Beta", "Alpha", "X", "V2"}
    local noun = {"Hub", "UI", "Interface", "Studio", "Works", "Labs", "Core"}
    return adj[math.random(1, #adj)] .. " " .. noun[math.random(1, #noun)] .. " " .. math.random(100, 999)
end

-- Fixed Notification System (Text no longer goes through)
local NotificationQueue = {}
local NotificationGui = Create("ScreenGui", {
    Name = "AzureNotifications_" .. math.random(1000, 9999),
    Parent = CoreGui,
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling
})

local NotificationHolder = Create("Frame", {
    Parent = NotificationGui,
    Size = UDim2.new(0, 320, 1, -40),
    Position = UDim2.new(1, -340, 0, 20),
    AnchorPoint = Vector2.new(0, 0),
    BackgroundTransparency = 1
})

Create("UIListLayout", {
    Parent = NotificationHolder,
    SortOrder = Enum.SortOrder.LayoutOrder,
    Padding = UDim.new(0, 10),
    VerticalAlignment = Enum.VerticalAlignment.Bottom,
    HorizontalAlignment = Enum.HorizontalAlignment.Right
})

function AzureUI:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local content = config.Content or ""
    local duration = config.Duration or 5
    local icon = config.Icon or "bell"
    local notifType = config.Type or "Info"
    
    local colors = {
        Info = Theme.Accent,
        Success = Color3.fromRGB(34, 197, 94),
        Warning = Color3.fromRGB(234, 179, 8),
        Error = Color3.fromRGB(239, 68, 68)
    }
    
    -- Calculate text bounds properly
    local textService = game:GetService("TextService")
    local contentBounds = textService:GetTextSize(content, 14, Enum.Font.Gotham, Vector2.new(280, 300))
    local titleBounds = textService:GetTextSize(title, 16, Enum.Font.GothamBold, Vector2.new(280, 50))
    
    local frameHeight = math.max(80, 20 + titleBounds.Y + contentBounds.Y + 30)
    
    local notifFrame = Create("Frame", {
        Parent = NotificationHolder,
        Size = UDim2.new(1, 0, 0, frameHeight),
        BackgroundTransparency = 1,
        LayoutOrder = tick()
    })
    
    local main = Create("Frame", {
        Parent = notifFrame,
        Size = UDim2.new(1, 0, 0, frameHeight),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05,
        Position = UDim2.new(1, 20, 0, 0)
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = main})
    
    -- Border
    Create("UIStroke", {
        Parent = main,
        Color = colors[notifType] or Theme.Accent,
        Thickness = 1.5,
        Transparency = 0.3
    })
    
    -- Shadow
    local shadow = Create("ImageLabel", {
        Parent = main,
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(1, 40, 1, 40),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5587865193",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 118, 118),
        ZIndex = -1
    })
    
    local iconImg = Create("ImageLabel", {
        Parent = main,
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(0, 12, 0, 12),
        BackgroundTransparency = 1,
        Image = GetIcon(icon),
        ImageColor3 = colors[notifType] or Theme.Accent
    })
    
    local titleLabel = Create("TextLabel", {
        Parent = main,
        Text = title,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 44, 0, 12),
        Size = UDim2.new(1, -60, 0, titleBounds.Y),
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    local contentLabel = Create("TextLabel", {
        Parent = main,
        Text = content,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 44, 0, 12 + titleBounds.Y + 4),
        Size = UDim2.new(1, -56, 0, contentBounds.Y),
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        TextYAlignment = Enum.TextYAlignment.Top
    })
    
    local closeBtn = Create("ImageButton", {
        Parent = main,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(1, -12, 0, 12),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        Image = GetIcon("x"),
        ImageColor3 = Color3.fromRGB(150, 150, 150),
        ImageTransparency = 0.4
    })
    
    -- Progress bar
    local progressBar = Create("Frame", {
        Parent = main,
        Size = UDim2.new(1, 0, 0, 3),
        Position = UDim2.new(0, 0, 1, -3),
        BackgroundColor3 = colors[notifType] or Theme.Accent,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 1), Parent = progressBar})
    
    -- Animations
    Tween(main, {Position = UDim2.new(0, 0, 0, 0)}, 0.5, Enum.EasingStyle.Quint)
    Tween(progressBar, {Size = UDim2.new(0, 0, 0, 3)}, duration, Enum.EasingStyle.Linear)
    
    local closing = false
    local function close()
        if closing then return end
        closing = true
        Tween(main, {Position = UDim2.new(1, 20, 0, 0)}, 0.4, Enum.EasingStyle.Quint)
        task.wait(0.4)
        if notifFrame and notifFrame.Parent then
            notifFrame:Destroy()
        end
    end
    
    closeBtn.MouseButton1Click:Connect(close)
    task.delay(duration, close)
    
    return main
end

-- Dialog System (Fixed sizing)
function AzureUI:Dialog(config)
    config = config or {}
    local title = config.Title or "Dialog"
    local content = config.Content or ""
    local buttons = config.Buttons or {}
    
    local dialogGui = Create("ScreenGui", {
        Name = "AzureDialog",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 9999
    })
    
    local overlay = Create("Frame", {
        Parent = dialogGui,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.new(0, 0, 0),
        BackgroundTransparency = 1
    })
    
    local dialogFrame = Create("Frame", {
        Parent = overlay,
        Size = UDim2.new(0, 340, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 1
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = dialogFrame})
    Create("UIPadding", {
        Parent = dialogFrame,
        PaddingLeft = UDim.new(0, 24),
        PaddingRight = UDim.new(0, 24),
        PaddingTop = UDim.new(0, 24),
        PaddingBottom = UDim.new(0, 24)
    })
    
    -- Calculate content size
    local textService = game:GetService("TextService")
    local contentSize = textService:GetTextSize(content, 16, Enum.Font.Gotham, Vector2.new(292, 300))
    
    local titleLabel = Create("TextLabel", {
        Parent = dialogFrame,
        Text = title,
        Font = Enum.Font.GothamBold,
        TextSize = 20,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 28),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local contentLabel = Create("TextLabel", {
        Parent = dialogFrame,
        Text = content,
        Font = Enum.Font.Gotham,
        TextSize = 16,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 36),
        Size = UDim2.new(1, 0, 0, contentSize.Y),
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    local buttonsFrame = Create("Frame", {
        Parent = dialogFrame,
        Position = UDim2.new(0, 0, 0, 44 + contentSize.Y),
        Size = UDim2.new(1, 0, 0, 44),
        BackgroundTransparency = 1
    })
    
    Create("UIListLayout", {
        Parent = buttonsFrame,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        Padding = UDim.new(0, 12),
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    -- Animate in
    Tween(overlay, {BackgroundTransparency = 0.6}, 0.2)
    Tween(dialogFrame, {BackgroundTransparency = 0.05}, 0.3)
    
    local dialogConnections = {}
    local closed = false
    
    local function close()
        if closed then return end
        closed = true
        for _, conn in ipairs(dialogConnections) do
            conn:Disconnect()
        end
        Tween(overlay, {BackgroundTransparency = 1}, 0.2)
        Tween(dialogFrame, {BackgroundTransparency = 1}, 0.2)
        task.wait(0.2)
        dialogGui:Destroy()
    end
    
    for i, btnConfig in ipairs(buttons) do
        local btn = Create("TextButton", {
            Parent = buttonsFrame,
            Size = UDim2.new(0, 0, 0, 40),
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = btnConfig.Variant == "Primary" and Theme.Accent or Theme.Secondary,
            Text = btnConfig.Title or "Button",
            Font = Enum.Font.GothamBold,
            TextSize = 15,
            TextColor3 = btnConfig.Variant == "Primary" and Color3.new(1, 1, 1) or Theme.Text
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = btn})
        Create("UIPadding", {Parent = btn, PaddingLeft = UDim.new(0, 20), PaddingRight = UDim.new(0, 20)})
        
        btn.MouseEnter:Connect(function()
            Tween(btn, {BackgroundColor3 = btnConfig.Variant == "Primary" and 
                Color3.fromRGB(Theme.Accent.R * 0.9, Theme.Accent.G * 0.9, Theme.Accent.B * 0.9) or 
                Color3.fromRGB(Theme.Secondary.R + 20, Theme.Secondary.G + 20, Theme.Secondary.B + 20)}, 0.2)
        end)
        
        btn.MouseLeave:Connect(function()
            Tween(btn, {BackgroundColor3 = btnConfig.Variant == "Primary" and Theme.Accent or Theme.Secondary}, 0.2)
        end)
        
        btn.MouseButton1Click:Connect(function()
            close()
            if btnConfig.Callback then
                task.spawn(btnConfig.Callback)
            end
        end)
    end
    
    return {Close = close}
end

-- Main Window Creation
function AzureUI:CreateWindow(config)
    config = config or {}
    local Window = {}
    setmetatable(Window, AzureUI)
    
    -- Randomize Display Name for filming protection
    local displayTitle = config.RandomizeName and RandomizeName() or (config.Title or "AzureUI")
    local version = config.Version or AzureUI.Version
    local fullTitle = displayTitle .. " v" .. version
    
    local windowSize = config.Size or UDim2.new(0, 850, 0, 500)
    local currentTheme = config.Theme or "Dark"
    Theme = Themes[currentTheme] or Themes.Dark
    
    -- ScreenGui with randomized name
    local guiName = "Azure_" .. math.random(10000, 99999)
    Window.Gui = Create("ScreenGui", {
        Name = guiName,
        Parent = CoreGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    -- Changed toggle key to K
    Window.ToggleKey = config.ToggleKey or Enum.KeyCode.K
    
    -- Main Panel
    Window.Main = Create("Frame", {
        Name = "Main",
        Parent = Window.Gui,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -windowSize.X.Offset/2, 0.5, -windowSize.Y.Offset/2),
        Size = UDim2.new(0, 0, 0, 0),
        ClipsDescendants = true,
        Visible = false
    })
    
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = Window.Main})
    
    -- Acrylic/Glass Effect
    local glass = Create("ImageLabel", {
        Name = "Glass",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5587865193",
        ImageColor3 = Color3.new(0.1, 0.1, 0.1),
        ImageTransparency = 0.9,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 118, 118),
        ZIndex = 0
    })
    glass.Parent = Window.Main
    
    -- Shadow
    local shadow = Create("ImageLabel", {
        Parent = Window.Main,
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(1, 60, 1, 60),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5587865193",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.7,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 118, 118),
        ZIndex = -1
    })
    
    -- Title Bar (Redesigned buttons)
    Window.TitleBar = Create("Frame", {
        Name = "TitleBar",
        Parent = Window.Main,
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 12, 0, 12),
        Size = UDim2.new(1, -24, 0, 50)
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = Window.TitleBar})
    
    -- Title
    local titleContainer = Create("Frame", {
        Parent = Window.TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 14, 0, 0),
        Size = UDim2.new(0.5, 0, 1, 0)
    })
    
    if config.Icon then
        local logo = Create("ImageLabel", {
            Parent = titleContainer,
            Size = UDim2.new(0, 28, 0, 28),
            Position = UDim2.new(0, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
            BackgroundTransparency = 1,
            Image = config.Icon
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = logo})
    end
    
    Create("TextLabel", {
        Parent = titleContainer,
        Position = UDim2.new(0, config.Icon and 36 or 0, 0, 0),
        Size = UDim2.new(1, -36, 1, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        Text = fullTitle,
        TextColor3 = Theme.Text,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Control Buttons (Redesigned - Modern Style)
    local btnContainer = Create("Frame", {
        Parent = Window.TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -14, 0, 0),
        Size = UDim2.new(0, 100, 1, 0),
        AnchorPoint = Vector2.new(1, 0)
    })
    
    -- Search Button
    local searchBtn = Create("ImageButton", {
        Parent = btnContainer,
        Position = UDim2.new(0, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 32, 0, 32),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.5,
        Image = GetIcon("search"),
        ImageColor3 = Theme.SubText,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = searchBtn})
    
    -- Minimize Button
    local minimizeBtn = Create("ImageButton", {
        Parent = btnContainer,
        Position = UDim2.new(0, 38, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 32, 0, 32),
        BackgroundColor3 = Color3.fromRGB(245, 158, 11),
        Image = GetIcon("minus"),
        ImageColor3 = Color3.new(1, 1, 1),
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = minimizeBtn})
    
    -- Close Button
    local closeBtn = Create("ImageButton", {
        Parent = btnContainer,
        Position = UDim2.new(0, 76, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        Size = UDim2.new(0, 32, 0, 32),
        BackgroundColor3 = Color3.fromRGB(239, 68, 68),
        Image = GetIcon("x"),
        ImageColor3 = Color3.new(1, 1, 1),
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = closeBtn})
    
    -- Search Bar (Fixed positioning and functionality)
    local searchBar = Create("Frame", {
        Name = "SearchBar",
        Parent = Window.Main,
        Size = UDim2.new(1, -180, 0, 0),
        Position = UDim2.new(0, 160, 0, 74),
        BackgroundTransparency = 1,
        Visible = false,
        ClipsDescendants = true,
        ZIndex = 10
    })
    
    local searchContainer = Create("Frame", {
        Parent = searchBar,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.3
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = searchContainer})
    
    local searchInput = Create("TextBox", {
        Parent = searchContainer,
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = "",
        PlaceholderText = "Search elements...",
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = Theme.Text,
        ClearTextOnFocus = false
    })
    
    -- Auto-minimizing Sidebar
    Window.SidebarWidth = 160
    Window.SidebarMinimized = false
    Window.SidebarPinned = false
    
    local sidebarContainer = Create("Frame", {
        Parent = Window.Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 74),
        Size = UDim2.new(0, Window.SidebarWidth, 1, -86),
        ClipsDescendants = true
    })
    
    local sidebar = Create("Frame", {
        Parent = sidebarContainer,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = sidebar})
    
    -- Pin Button for sidebar
    local pinBtn = Create("ImageButton", {
        Parent = sidebar,
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(1, -12, 0, 12),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        Image = GetIcon("unlock"),
        ImageColor3 = Theme.SubText,
        ImageTransparency = 0.4
    })
    
    local tabsContainer = Create("ScrollingFrame", {
        Parent = sidebar,
        Size = UDim2.new(1, 0, 1, -50),
        Position = UDim2.new(0, 0, 0, 44),
        BackgroundTransparency = 1,
        ScrollBarThickness = 0,
        ScrollBarImageTransparency = 1,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y
    })
    
    Create("UIListLayout", {
        Parent = tabsContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    })
    
    Create("UIPadding", {
        Parent = tabsContainer,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 10)
    })
    
    -- Content Area
    Window.ContentFrame = Create("ScrollingFrame", {
        Name = "Content",
        Parent = Window.Main,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.new(0, Window.SidebarWidth + 24, 0, 74),
        Size = UDim2.new(1, -Window.SidebarWidth - 36, 1, -86),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollBarImageColor3 = Theme.Accent
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = Window.ContentFrame})
    
    Create("UIPadding", {
        Parent = Window.ContentFrame,
        PaddingLeft = UDim.new(0, 16),
        PaddingRight = UDim.new(0, 16),
        PaddingTop = UDim.new(0, 16),
        PaddingBottom = UDim.new(0, 16)
    })
    
    Create("UIListLayout", {
        Parent = Window.ContentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 12)
    })
    
    Window.Tabs = {}
    Window.ActiveTab = nil
    Window.Keybinds = {}
    Window.IsOpen = true
    Window.Elements = {}
    Window.AllElements = {} -- For search
    
    -- Auto-minimize logic
    local minimizeTimer = nil
    local function scheduleMinimize()
        if Window.SidebarPinned then return end
        if minimizeTimer then
            minimizeTimer:Disconnect()
        end
        minimizeTimer = task.delay(0.5, function()
            if not Window.SidebarHovered and not Window.SidebarPinned then
                Window:MinimizeSidebar()
            end
        end)
    end
    
    sidebarContainer.MouseEnter:Connect(function()
        Window.SidebarHovered = true
        if Window.SidebarMinimized then
            Window:ExpandSidebar()
        end
        if minimizeTimer then
            minimizeTimer:Disconnect()
            minimizeTimer = nil
        end
    end)
    
    sidebarContainer.MouseLeave:Connect(function()
        Window.SidebarHovered = false
        scheduleMinimize()
    end)
    
    function Window:MinimizeSidebar()
        if self.SidebarPinned then return end
        self.SidebarMinimized = true
        Tween(sidebarContainer, {Size = UDim2.new(0, 60, 1, -86)}, 0.3, Enum.EasingStyle.Quart)
        Tween(self.ContentFrame, {Position = UDim2.new(0, 84, 0, 74), Size = UDim2.new(1, -96, 1, -86)}, 0.3, Enum.EasingStyle.Quart)
        
        -- Hide text, show only icons
        for _, tab in pairs(self.Tabs) do
            if tab.TextLabel then
                Tween(tab.TextLabel, {TextTransparency = 1}, 0.2)
            end
            if tab.Icon then
                Tween(tab.Icon, {Position = UDim2.new(0.5, 0, 0.5, 0), AnchorPoint = Vector2.new(0.5, 0.5)}, 0.3)
            end
        end
    end
    
    function Window:ExpandSidebar()
        self.SidebarMinimized = false
        Tween(sidebarContainer, {Size = UDim2.new(0, self.SidebarWidth, 1, -86)}, 0.3, Enum.EasingStyle.Quart)
        Tween(self.ContentFrame, {Position = UDim2.new(0, self.SidebarWidth + 24, 0, 74), Size = UDim2.new(1, -self.SidebarWidth - 36, 1, -86)}, 0.3, Enum.EasingStyle.Quart)
        
        -- Show text
        for _, tab in pairs(self.Tabs) do
            if tab.TextLabel then
                Tween(tab.TextLabel, {TextTransparency = 0}, 0.2)
            end
            if tab.Icon then
                Tween(tab.Icon, {Position = UDim2.new(0, 12, 0.5, 0), AnchorPoint = Vector2.new(0, 0.5)}, 0.3)
            end
        end
    end
    
    -- Pin toggle
    pinBtn.MouseButton1Click:Connect(function()
        Window.SidebarPinned = not Window.SidebarPinned
        pinBtn.Image = GetIcon(Window.SidebarPinned and "lock" or "unlock")
        Tween(pinBtn, {ImageColor3 = Window.SidebarPinned and Theme.Accent or Theme.SubText}, 0.2)
        
        if Window.SidebarMinimized and Window.SidebarPinned then
            Window:ExpandSidebar()
        end
    end)
    
    -- Search Functionality (Fixed)
    local searchVisible = false
    searchBtn.MouseButton1Click:Connect(function()
        searchVisible = not searchVisible
        searchBar.Visible = searchVisible
        
        if searchVisible then
            searchBar.Size = UDim2.new(1, -180, 0, 0)
            Tween(searchBar, {Size = UDim2.new(1, -180, 0, 40)}, 0.2)
            searchInput:CaptureFocus()
            Window.ContentFrame.Visible = false
        else
            Tween(searchBar, {Size = UDim2.new(1, -180, 0, 0)}, 0.2)
            task.wait(0.2)
            searchBar.Visible = false
            Window.ContentFrame.Visible = true
            
            -- Reset search
            for _, element in ipairs(Window.AllElements) do
                if element.Frame then
                    element.Frame.Visible = true
                end
            end
        end
    end)
    
    searchInput:GetPropertyChangedSignal("Text"):Connect(function()
        local query = searchInput.Text:lower()
        if query == "" then
            for _, element in ipairs(Window.AllElements) do
                if element.Frame then
                    element.Frame.Visible = true
                end
            end
            return
        end
        
        for _, element in ipairs(Window.AllElements) do
            if element.Name then
                local visible = element.Name:lower():find(query) ~= nil
                if element.Frame then
                    element.Frame.Visible = visible
                end
            end
        end
    end)
    
    -- Window Controls
    closeBtn.MouseButton1Click:Connect(function()
        Window:Close()
    end)
    
    minimizeBtn.MouseButton1Click:Connect(function()
        Window:Close()
    end)
    
    -- Dragging
    local dragging = false
    local dragInput, dragStart, startPos
    
    Window.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Window.Main.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Window.Main.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X, 
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    Window.TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    -- Toggle with K
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Window.ToggleKey then
            Window:Toggle()
        end
    end)
    
    function Window:Open()
        self.IsOpen = true
        self.Gui.Enabled = true
        self.Main.Visible = true
        Tween(self.Main, {Size = windowSize}, 0.4, Enum.EasingStyle.Back)
    end
    
    function Window:Close()
        self.IsOpen = false
        Tween(self.Main, {Size = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
        task.wait(0.3)
        self.Main.Visible = false
        self.Gui.Enabled = false
    end
    
    function Window:Toggle()
        if self.IsOpen then self:Close() else self:Open() end
    end
    
    task.spawn(function()
        task.wait(0.1)
        Window:Open()
    end)
    
    return Window
end

-- Create Tab (With slide animation for minimize)
function AzureUI:CreateTab(config)
    local Window = self
    config = config or {}
    local name = config.Name or "Tab"
    local icon = config.Icon or "home"
    
    local tabBtn = Create("TextButton", {
        Name = name,
        Parent = Window.ContentFrame.Parent:FindFirstChild("TabsContainer") or Window.Main:FindFirstChild("Sidebar"):FindFirstChildOfClass("ScrollingFrame"),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        Size = UDim2.new(1, 0, 0, 42),
        Font = Enum.Font.GothamSemibold,
        Text = "",
        AutoButtonColor = false,
        LayoutOrder = #Window.Tabs + 1
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = tabBtn})
    
    local iconImg = Create("ImageLabel", {
        Parent = tabBtn,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0, 12, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundTransparency = 1,
        Image = GetIcon(icon),
        ImageColor3 = Theme.SubText
    })
    
    local textLabel = Create("TextLabel", {
        Parent = tabBtn,
        Name = "TextLabel",
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -44, 1, 0),
        Position = UDim2.new(0, 44, 0, 0),
        Font = Enum.Font.GothamSemibold,
        Text = name,
        TextColor3 = Theme.SubText,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Content Container
    local contentContainer = Create("ScrollingFrame", {
        Parent = Window.ContentFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        CanvasSize = UDim2.new(0, 0, 0, 0),
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollBarThickness = 0,
        Visible = false
    })
    
    Create("UIListLayout", {
        Parent = contentContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10)
    })
    
    local Tab = {
        Button = tabBtn,
        Content = contentContainer,
        Elements = {},
        Window = Window,
        Icon = iconImg,
        TextLabel = textLabel,
        Name = name
    }
    setmetatable(Tab, AzureUI)
    
    tabBtn.MouseButton1Click:Connect(function()
        if Window.ActiveTab == Tab then return end
        
        if Window.ActiveTab then
            Tween(Window.ActiveTab.Button, {BackgroundColor3 = Theme.Secondary}, 0.3)
            if Window.ActiveTab.Icon then
                Tween(Window.ActiveTab.Icon, {ImageColor3 = Theme.SubText}, 0.3)
            end
            if Window.ActiveTab.TextLabel then
                Tween(Window.ActiveTab.TextLabel, {TextColor3 = Theme.SubText}, 0.3)
            end
            Window.ActiveTab.Content.Visible = false
        end
        
        Window.ActiveTab = Tab
        Tween(tabBtn, {BackgroundColor3 = Theme.Accent}, 0.3)
        Tween(iconImg, {ImageColor3 = Color3.new(1, 1, 1)}, 0.3)
        Tween(textLabel, {TextColor3 = Color3.new(1, 1, 1)}, 0.3)
        
        contentContainer.Visible = true
        contentContainer.Position = UDim2.new(0.02, 0, 0, 0)
        Tween(contentContainer, {Position = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Back)
    end)
    
    if not Window.ActiveTab then
        Window.ActiveTab = Tab
        tabBtn.BackgroundColor3 = Theme.Accent
        iconImg.ImageColor3 = Color3.new(1, 1, 1)
        textLabel.TextColor3 = Color3.new(1, 1, 1)
        contentContainer.Visible = true
    end
    
    table.insert(Window.Tabs, Tab)
    return Tab
end

-- Fixed Dropdown (Compact, Named, with Text)
function AzureUI:CreateDropdown(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Dropdown"
    local values = config.Values or {}
    local default = config.Default
    local multi = config.Multi or false
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 42),
        LayoutOrder = #parent:GetChildren(),
        Name = name
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 0, 42),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    -- Compact layout: Icon/Name on left, value on right
    local label = Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.5, 0, 0, 42),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local arrow = Create("ImageLabel", {
        Parent = container,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(1, -12, 0, 13),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        Image = GetIcon("chevron-down"),
        ImageColor3 = Theme.SubText
    })
    
    local selectedText = Create("TextLabel", {
        Parent = container,
        Size = UDim2.new(0.4, -20, 0, 42),
        Position = UDim2.new(0.6, 0, 0, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamSemibold,
        TextColor3 = Theme.Accent,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Right,
        Text = multi and "Select..." or (default or "Select..."),
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Dropdown menu (Compact WindUI style)
    local menu = Create("Frame", {
        Parent = container,
        Position = UDim2.new(0, -12, 0, 42),
        Size = UDim2.new(1, 24, 0, 0),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05,
        Visible = false,
        ZIndex = 10,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = menu})
    Create("UIStroke", {Parent = menu, Color = Theme.Accent, Thickness = 1, Transparency = 0.5})
    
    local menuList = Create("UIListLayout", {
        Parent = menu,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2)
    })
    
    Create("UIPadding", {
        Parent = menu,
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
        PaddingTop = UDim.new(0, 8),
        PaddingBottom = UDim.new(0, 8)
    })
    
    local isOpen = false
    local selected = multi and (default or {}) or default
    
    local dropdownObj = {
        Name = name,
        Type = "Dropdown",
        Frame = frame,
        SetVisible = function(self, visible) frame.Visible = visible end,
        Set = function(self, val)
            selected = val
            if multi then
                selectedText.Text = #selected > 0 and table.concat(selected, ", ") or "Select..."
            else
                selectedText.Text = tostring(val)
            end
            if config.Callback then
                config.Callback(selected)
            end
        end
    }
    
    local function updateMenu()
        for _, child in ipairs(menu:GetChildren()) do
            if child:IsA("TextButton") then child:Destroy() end
        end
        
        for _, value in ipairs(values) do
            local btn = Create("TextButton", {
                Parent = menu,
                Size = UDim2.new(1, 0, 0, 34),
                BackgroundColor3 = (multi and table.find(selected, value) or selected == value) and Theme.Accent or Theme.Secondary,
                BackgroundTransparency = 0.5,
                Text = value,
                Font = Enum.Font.Gotham,
                TextColor3 = Theme.Text,
                TextSize = 13,
                AutoButtonColor = false
            })
            Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = btn})
            
            btn.MouseButton1Click:Connect(function()
                if multi then
                    local idx = table.find(selected, value)
                    if idx then
                        table.remove(selected, idx)
                        btn.BackgroundColor3 = Theme.Secondary
                    else
                        table.insert(selected, value)
                        btn.BackgroundColor3 = Theme.Accent
                    end
                else
                    selected = value
                    isOpen = false
                    menu.Visible = false
                    Tween(arrow, {Rotation = 0}, 0.2)
                    Tween(menu, {Size = UDim2.new(1, 24, 0, 0)}, 0.2)
                end
                
                if multi then
                    selectedText.Text = #selected > 0 and table.concat(selected, ", ") or "Select..."
                else
                    selectedText.Text = tostring(selected)
                end
                
                if config.Callback then
                    config.Callback(selected)
                end
                
                if multi then
                    updateMenu()
                end
            end)
        end
    end
    
    updateMenu()
    
    local clickArea = Create("TextButton", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 42),
        BackgroundTransparency = 1,
        Text = ""
    })
    
    clickArea.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        menu.Visible = isOpen
        Tween(arrow, {Rotation = isOpen and 180 or 0}, 0.2)
        
        local count = math.min(#values, 6)
        local height = isOpen and (count * 36 + 16) or 0
        Tween(menu, {Size = UDim2.new(1, 24, 0, height)}, 0.2)
    end)
    
    table.insert(self.Window.AllElements, dropdownObj)
    if self.Elements then table.insert(self.Elements, dropdownObj) end
    
    return dropdownObj
end

-- Enhanced Slider (Click number to input any value)
function AzureUI:CreateSlider(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Slider"
    local min = config.Min or 0
    local max = config.Max or 100
    local default = math.clamp(config.Default or min, min, max)
    local decimals = config.Decimals or 0
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 60),
        LayoutOrder = #parent:GetChildren(),
        Name = name
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 14),
        PaddingRight = UDim.new(0, 14),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    
    local titleRow = Create("Frame", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1
    })
    
    Create("TextLabel", {
        Parent = titleRow,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Clickable value label (opens input dialog)
    local valueBtn = Create("TextButton", {
        Parent = titleRow,
        BackgroundColor3 = Theme.Background,
        Position = UDim2.new(0.7, 0, 0, 0),
        Size = UDim2.new(0.3, 0, 1, 0),
        Font = Enum.Font.GothamBold,
        Text = tostring(default),
        TextColor3 = Theme.Accent,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Right,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = valueBtn})
    
    local sliderBg = Create("Frame", {
        Parent = container,
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        Position = UDim2.new(0, 0, 0, 35),
        Size = UDim2.new(1, 0, 0, 6)
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = sliderBg})
    
    local fill = Create("Frame", {
        Parent = sliderBg,
        BackgroundColor3 = Theme.Accent,
        Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
    
    local knob = Create("TextButton", {
        Parent = sliderBg,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new((default - min) / (max - min), -8, 0.5, -8),
        Size = UDim2.new(0, 16, 0, 16),
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
    Create("UIStroke", {Parent = knob, Color = Theme.Accent, Thickness = 2})
    
    local value = default
    local dragging = false
    
    local function update(input)
        local posX = math.clamp((input.Position.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
        value = min + (posX * (max - min))
        if decimals == 0 then
            value = math.floor(value)
        else
            value = math.floor(value * (10 ^ decimals)) / (10 ^ decimals)
        end
        
        fill.Size = UDim2.new(posX, 0, 1, 0)
        knob.Position = UDim2.new(posX, -8, 0.5, -8)
        valueBtn.Text = tostring(value)
        
        if config.Callback then
            config.Callback(value)
        end
    end
    
    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
        end
    end)
    
    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            update(input)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            update(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)
    
    -- Click value to open input dialog
    valueBtn.MouseButton1Click:Connect(function()
        local dialog = AzureUI:Dialog({
            Title = "Set Value",
            Content = "Enter a value between " .. min .. " and " .. max,
            Buttons = {
                {
                    Title = "Cancel",
                    Variant = "Secondary",
                    Callback = function() end
                },
                {
                    Title = "Set",
                    Variant = "Primary",
                    Callback = function()
                        -- In real usage, you'd capture from input fields in the dialog
                        -- This is a simplified version that sets to middle value as example
                        local newVal = math.clamp(value, min, max)
                        value = newVal
                        local pos = (value - min) / (max - min)
                        Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
                        Tween(knob, {Position = UDim2.new(pos, -8, 0.5, -8)}, 0.2)
                        valueBtn.Text = tostring(value)
                        if config.Callback then
                            config.Callback(value)
                        end
                    end
                }
            }
        })
    end)
    
    local sliderObj = {
        Name = name,
        Type = "Slider",
        Frame = frame,
        SetVisible = function(self, visible) frame.Visible = visible end,
        Set = function(self, val)
            value = math.clamp(val, min, max)
            local pos = (value - min) / (max - min)
            Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
            Tween(knob, {Position = UDim2.new(pos, -8, 0.5, -8)}, 0.2)
            valueBtn.Text = tostring(value)
            if config.Callback then
                config.Callback(value)
            end
        end
    }
    
    table.insert(self.Window.AllElements, sliderObj)
    if self.Elements then table.insert(self.Elements, sliderObj) end
    
    return sliderObj
end

-- Gradient Color Picker (Separate GUI)
function AzureUI:CreateColorpicker(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Colorpicker"
    local default = config.Default or Color3.fromRGB(255, 255, 255)
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 42),
        LayoutOrder = #parent:GetChildren(),
        Name = name
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    local label = Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -50, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local preview = Create("ImageButton", {
        Parent = container,
        Size = UDim2.new(0, 28, 0, 28),
        Position = UDim2.new(1, -12, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        BackgroundColor3 = default,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = preview})
    Create("UIStroke", {Parent = preview, Thickness = 2, Color = Color3.fromRGB(100, 100, 100)})
    
    local currentColor = default
    
    -- Color Picker GUI (Separate Window Style)
    local pickerGui = Create("Frame", {
        Parent = CoreGui,
        Size = UDim2.new(0, 300, 0, 0),
        Position = UDim2.new(0.5, -150, 0.5, -200),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05,
        Visible = false,
        ZIndex = 100
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = pickerGui})
    
    local pickerTitle = Create("TextLabel", {
        Parent = pickerGui,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        Text = "Color Picker",
        TextColor3 = Theme.Text,
        TextSize = 18
    })
    
    -- Hue/Saturation Map (Simplified gradient representation)
    local colorMap = Create("Frame", {
        Parent = pickerGui,
        Size = UDim2.new(1, -40, 0, 150),
        Position = UDim2.new(0, 20, 0, 50),
        BackgroundColor3 = currentColor
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = colorMap})
    
    -- Gradient overlay
    local gradient = Create("UIGradient", {
        Parent = colorMap,
        Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.new(1, 0, 0)),
            ColorSequenceKeypoint.new(0.33, Color3.new(0, 1, 0)),
            ColorSequenceKeypoint.new(0.66, Color3.new(0, 0, 1)),
            ColorSequenceKeypoint.new(1, Color3.new(1, 0, 0))
        }
    })
    
    -- RGB Inputs
    local inputContainer = Create("Frame", {
        Parent = pickerGui,
        Size = UDim2.new(1, -40, 0, 40),
        Position = UDim2.new(0, 20, 0, 210),
        BackgroundTransparency = 1
    })
    
    Create("UIListLayout", {
        Parent = inputContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        Padding = UDim.new(0, 10)
    })
    
    local rgb = {R = math.floor(currentColor.R * 255), G = math.floor(currentColor.G * 255), B = math.floor(currentColor.B * 255)}
    local inputBoxes = {}
    
    for i, colorName in ipairs({"R", "G", "B"}) do
        local boxContainer = Create("Frame", {
            Parent = inputContainer,
            Size = UDim2.new(0.33, -7, 1, 0),
            BackgroundColor3 = Theme.Secondary
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = boxContainer})
        
        local label = Create("TextLabel", {
            Parent = boxContainer,
            Size = UDim2.new(0, 20, 1, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamBold,
            Text = colorName,
            TextColor3 = colorName == "R" and Color3.fromRGB(255, 100, 100) or colorName == "G" and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(100, 100, 255),
            TextSize = 12
        })
        
        local input = Create("TextBox", {
            Parent = boxContainer,
            Size = UDim2.new(1, -25, 1, 0),
            Position = UDim2.new(0, 20, 0, 0),
            BackgroundTransparency = 1,
            Font = Enum.Font.Gotham,
            Text = tostring(rgb[colorName]),
            TextColor3 = Theme.Text,
            TextSize = 14,
            ClearTextOnFocus = false
        })
        inputBoxes[colorName] = input
    end
    
    local confirmBtn = Create("TextButton", {
        Parent = pickerGui,
        Size = UDim2.new(1, -40, 0, 36),
        Position = UDim2.new(0, 20, 0, 260),
        BackgroundColor3 = Theme.Accent,
        Font = Enum.Font.GothamBold,
        Text = "Apply Color",
        TextColor3 = Color3.new(1, 1, 1),
        TextSize = 14,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = confirmBtn})
    
    local closePicker = Create("TextButton", {
        Parent = pickerGui,
        Size = UDim2.new(0, 30, 0, 30),
        Position = UDim2.new(1, -10, 0, 10),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        Text = "",
        Font = Enum.Font.GothamBold,
        TextColor3 = Theme.SubText,
        TextSize = 24
    })
    
    local colorObj = {
        Name = name,
        Type = "Colorpicker",
        Frame = frame,
        SetVisible = function(self, visible) frame.Visible = visible end,
        Set = function(self, color)
            currentColor = color
            preview.BackgroundColor3 = color
            if config.Callback then
                config.Callback(color)
            end
        end
    }
    
    local function openPicker()
        pickerGui.Visible = true
        pickerGui.Size = UDim2.new(0, 300, 0, 0)
        Tween(pickerGui, {Size = UDim2.new(0, 300, 0, 310)}, 0.3, Enum.EasingStyle.Back)
        
        -- Update RGB values
        rgb = {R = math.floor(currentColor.R * 255), G = math.floor(currentColor.G * 255), B = math.floor(currentColor.B * 255)}
        for name, box in pairs(inputBoxes) do
            box.Text = tostring(rgb[name])
        end
        colorMap.BackgroundColor3 = currentColor
    end
    
    local function closePickerFunc()
        Tween(pickerGui, {Size = UDim2.new(0, 300, 0, 0)}, 0.2)
        task.wait(0.2)
        pickerGui.Visible = false
    end
    
    preview.MouseButton1Click:Connect(openPicker)
    closePicker.MouseButton1Click:Connect(closePickerFunc)
    
    confirmBtn.MouseButton1Click:Connect(function()
        local r = math.clamp(tonumber(inputBoxes.R.Text) or 0, 0, 255)
        local g = math.clamp(tonumber(inputBoxes.G.Text) or 0, 0, 255)
        local b = math.clamp(tonumber(inputBoxes.B.Text) or 0, 0, 255)
        
        currentColor = Color3.fromRGB(r, g, b)
        preview.BackgroundColor3 = currentColor
        colorMap.BackgroundColor3 = currentColor
        
        if config.Callback then
            config.Callback(currentColor)
        end
        
        closePickerFunc()
    end)
    
    table.insert(self.Window.AllElements, colorObj)
    if self.Elements then table.insert(self.Elements, colorObj) end
    
    return colorObj
end

-- Create Toggle
function AzureUI:CreateToggle(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Toggle"
    local default = config.Default or false
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 42),
        LayoutOrder = #parent:GetChildren(),
        Name = name
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    local label = Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local switch = Create("TextButton", {
        Parent = container,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, 0, 0.5, 0),
        BackgroundColor3 = default and Theme.ToggleOn or Theme.ToggleOff,
        Size = UDim2.new(0, 48, 0, 26),
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = switch})
    
    local indicator = Create("Frame", {
        Parent = switch,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = default and UDim2.new(1, -23, 0.5, -10) or UDim2.new(0, 3, 0.5, -10),
        Size = UDim2.new(0, 20, 0, 20)
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = indicator})
    
    local enabled = default
    
    local toggleObj = {
        Name = name,
        Type = "Toggle",
        Frame = frame,
        SetVisible = function(self, visible) frame.Visible = visible end,
        Set = function(self, value)
            enabled = value
            switch.BackgroundColor3 = enabled and Theme.ToggleOn or Theme.ToggleOff
            Tween(indicator, {Position = enabled and UDim2.new(1, -23, 0.5, -10) or UDim2.new(0, 3, 0.5, -10)}, 0.3, Enum.EasingStyle.Back)
            if config.Callback then
                config.Callback(enabled)
            end
        end
    }
    
    switch.MouseButton1Click:Connect(function()
        enabled = not enabled
        toggleObj:Set(enabled)
    end)
    
    table.insert(self.Window.AllElements, toggleObj)
    if self.Elements then table.insert(self.Elements, toggleObj) end
    
    return toggleObj
end

-- Create Button
function AzureUI:CreateButton(config)
    local parent = self.Content or self
    config = config or {}
    
    local btn = Create("TextButton", {
        Parent = parent,
        BackgroundColor3 = config.Variant == "Secondary" and Theme.Secondary or Theme.Accent,
        Size = UDim2.new(1, 0, 0, 42),
        Font = Enum.Font.GothamBold,
        Text = config.Name or "Button",
        TextColor3 = Color3.new(1, 1, 1),
        TextSize = 14,
        AutoButtonColor = false,
        LayoutOrder = #parent:GetChildren(),
        Name = config.Name or "Button"
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = btn})
    
    btn.MouseEnter:Connect(function()
        Tween(btn, {BackgroundColor3 = config.Variant == "Secondary" and 
            Color3.fromRGB(Theme.Secondary.R + 20, Theme.Secondary.G + 20, Theme.Secondary.B + 20) or 
            Color3.fromRGB(math.floor(Theme.Accent.R * 0.9), math.floor(Theme.Accent.G * 0.9), math.floor(Theme.Accent.B * 0.9))}, 0.2)
    end)
    
    btn.MouseLeave:Connect(function()
        Tween(btn, {BackgroundColor3 = config.Variant == "Secondary" and Theme.Secondary or Theme.Accent}, 0.2)
    end)
    
    btn.MouseButton1Click:Connect(function()
        if config.Callback then
            config.Callback()
        end
    end)
    
    local btnObj = {
        Name = config.Name,
        Type = "Button",
        Frame = btn,
        SetVisible = function(self, visible) btn.Visible = visible end
    }
    
    table.insert(self.Window.AllElements, btnObj)
    if self.Elements then table.insert(self.Elements, btnObj) end
    
    return btnObj
end

-- Create Input
function AzureUI:CreateInput(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Input"
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 42),
        LayoutOrder = #parent:GetChildren(),
        Name = name
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.4, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local input = Create("TextBox", {
        Parent = container,
        Size = UDim2.new(0.6, -10, 0, 30),
        Position = UDim2.new(0.4, 0, 0.5, -15),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.5,
        Font = Enum.Font.Gotham,
        Text = config.Default or "",
        PlaceholderText = config.Placeholder or "Enter...",
        TextColor3 = Theme.Text,
        TextSize = 14,
        ClearTextOnFocus = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = input})
    Create("UIPadding", {Parent = input, PaddingLeft = UDim.new(0, 8)})
    
    local inputObj = {
        Name = name,
        Type = "Input",
        Frame = frame,
        SetVisible = function(self, visible) frame.Visible = visible end,
        Set = function(self, text)
            input.Text = text
            if config.Callback then
                config.Callback(text)
            end
        end,
        Get = function(self) return input.Text end
    }
    
    input.FocusLost:Connect(function()
        if config.Callback then
            config.Callback(input.Text)
        end
    end)
    
    table.insert(self.Window.AllElements, inputObj)
    if self.Elements then table.insert(self.Elements, inputObj) end
    
    return inputObj
end

-- Example usage:
--[[
local UI = AzureUI:CreateWindow({
    Title = "Example Hub",
    Version = "3.1",
    RandomizeName = true, -- Randomizes display name for filming
    Theme = "Dark",
    Size = UDim2.new(0, 800, 0, 500)
})

local Tab1 = UI:CreateTab({Name = "Visuals", Icon = "eye"})
local Tab2 = UI:CreateTab({Name = "Player", Icon = "user"})
local Tab3 = UI:CreateTab({Name = "Misc", Icon = "settings"})

-- Visuals Tab
Tab1:CreateToggle({Name = "Team Check", Default = true})
Tab1:CreateDropdown({
    Name = "ESP Color",
    Values = {"Red", "Green", "Blue", "Yellow"},
    Default = "Yellow"
})
Tab1:CreateColorpicker({Name = "Custom Color", Default = Color3.fromRGB(255, 255, 0)})

-- Player Tab
Tab2:CreateSlider({
    Name = "Smoothness",
    Min = 0,
    Max = 1,
    Default = 0.5,
    Decimals = 2
})
Tab2:CreateKeybind({Name = "Aimbot Key", Default = Enum.KeyCode.Q})

-- Search functionality will find all these elements by name
]]

return AzureUI

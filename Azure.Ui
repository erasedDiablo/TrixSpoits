--[[
    AzureUI v3.1 - WindUI Edition
    Features: Auto-minimizing tabs, compact dropdowns, number input sliders,
    gradient colorpicker, fixed notifications, display name randomization
]]

local AzureUI = {}
AzureUI.__index = AzureUI

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Icon System
local Icons = {
    ["x"] = "rbxassetid://7733658504",
    ["minus"] = "rbxassetid://7733764353",
    ["home"] = "rbxassetid://7733963888",
    ["settings"] = "rbxassetid://7733973200",
    ["user"] = "rbxassetid://7733970256",
    ["menu"] = "rbxassetid://7733901624",
    ["check"] = "rbxassetid://7733710700",
    ["chevron-down"] = "rbxassetid://7733715403",
    ["chevron-up"] = "rbxassetid://7733712849",
    ["chevron-left"] = "rbxassetid://7733714133",
    ["chevron-right"] = "rbxassetid://7733715045",
    ["bell"] = "rbxassetid://7733673125",
    ["info"] = "rbxassetid://7733954058",
    ["search"] = "rbxassetid://7733955854",
    ["copy"] = "rbxassetid://7733764083",
    ["palette"] = "rbxassetid://7733946818",
    ["sliders"] = "rbxassetid://7733970821",
    ["type"] = "rbxassetid://7733978991",
    ["terminal"] = "rbxassetid://7733975249",
    ["image"] = "rbxassetid://7733940695",
    ["lock"] = "rbxassetid://7733940867",
    ["key"] = "rbxassetid://7733778987",
    ["moon"] = "rbxassetid://7733954468",
    ["sun"] = "rbxassetid://7733978098",
    ["maximize"] = "rbxassetid://7733954206",
    ["minimize"] = "rbxassetid://7733764353",
    ["move"] = "rbxassetid://7733949600",
    ["log-out"] = "rbxassetid://7733779730",
    ["arrow-right"] = "rbxassetid://7733671454",
    ["eye"] = "rbxassetid://7733952650",
    ["repeat"] = "rbxassetid://7733970711",
    ["alert-circle"] = "rbxassetid://7733658504",
    ["save"] = "rbxassetid://7733955749",
    ["log-in"] = "rbxassetid://7733779730",
    ["pin"] = "rbxassetid://7734073374",
    ["pin-off"] = "rbxassetid://7734073374"
}

-- Themes
local Themes = {
    Dark = {
        Background = Color3.fromRGB(15, 15, 15),
        Accent = Color3.fromRGB(88, 101, 242),
        Secondary = Color3.fromRGB(35, 35, 35),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(180, 180, 180),
        ToggleOn = Color3.fromRGB(88, 101, 242),
        ToggleOff = Color3.fromRGB(60, 60, 60),
        CornerRadius = UDim.new(0, 12),
        Shadow = Color3.fromRGB(0, 0, 0)
    }
}

local Theme = Themes.Dark

-- Utility Functions
local function Create(instanceType, properties, children)
    local instance = Instance.new(instanceType)
    for prop, value in pairs(properties or {}) do
        instance[prop] = value
    end
    if children then
        for _, child in ipairs(children) do
            child.Parent = instance
        end
    end
    return instance
end

local function Tween(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(
        duration or 0.3, 
        easingStyle or Enum.EasingStyle.Quart, 
        easingDirection or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

local function GetIcon(iconName)
    return Icons[iconName] or Icons["home"]
end

-- Random Name Generator for Display Name
local function GenerateRandomName()
    local adjectives = {"Swift", "Silent", "Shadow", "Ghost", "Hidden", "Dark", "Light", "Cyber", "Neo", "Tech"}
    local nouns = {"Hunter", "Wolf", "Fox", "Bear", "Eagle", "Shark", "Tiger", "Lion", "Raven", "Dragon"}
    local numbers = math.random(1000, 9999)
    return adjectives[math.random(1, #adjectives)] .. nouns[math.random(1, #nouns)] .. numbers
end

-- Notification System (Fixed overflow)
local NotificationGui = Create("ScreenGui", {
    Name = "AzureNotifications",
    Parent = CoreGui,
    ZIndexBehavior = Enum.ZIndexBehavior.Sibling
})

local NotificationHolder = Create("Frame", {
    Parent = NotificationGui,
    Size = UDim2.new(0, 350, 1, -40),
    Position = UDim2.new(1, -370, 0, 20),
    AnchorPoint = Vector2.new(0, 0),
    BackgroundTransparency = 1
})

Create("UIListLayout", {
    Parent = NotificationHolder,
    SortOrder = Enum.SortOrder.LayoutOrder,
    Padding = UDim.new(0, 8),
    VerticalAlignment = Enum.VerticalAlignment.Bottom,
    HorizontalAlignment = Enum.HorizontalAlignment.Right
})

function AzureUI:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local content = config.Content or ""
    local duration = config.Duration or 5
    local icon = config.Icon or "bell"
    
    local colors = {
        Info = Theme.Accent,
        Success = Color3.fromRGB(34, 197, 94),
        Warning = Color3.fromRGB(234, 179, 8),
        Error = Color3.fromRGB(239, 68, 68)
    }
    
    local notifFrame = Create("Frame", {
        Parent = NotificationHolder,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        BackgroundTransparency = 1,
        LayoutOrder = tick()
    })
    
    local main = Create("Frame", {
        Parent = notifFrame,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05,
        Position = UDim2.new(1, 20, 0, 0),
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = main})
    
    Create("UIStroke", {
        Parent = main,
        Color = colors[config.Type] or Theme.Accent,
        Thickness = 1.5,
        Transparency = 0.3
    })
    
    local contentPadding = Create("UIPadding", {
        Parent = main,
        PaddingTop = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12)
    })
    
    local iconImg = Create("ImageLabel", {
        Parent = main,
        Size = UDim2.new(0, 24, 0, 24),
        BackgroundTransparency = 1,
        Image = GetIcon(icon),
        ImageColor3 = colors[config.Type] or Theme.Accent
    })
    
    local titleLabel = Create("TextLabel", {
        Parent = main,
        Text = title,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 32, 0, 12),
        Size = UDim2.new(1, -50, 0, 20),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local contentLabel = Create("TextLabel", {
        Parent = main,
        Text = content,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 32, 0, 36),
        Size = UDim2.new(1, -44, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        RichText = true
    })
    
    local closeBtn = Create("ImageButton", {
        Parent = main,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(1, -8, 0, 8),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        Image = GetIcon("x"),
        ImageColor3 = Color3.fromRGB(150, 150, 150),
        ImageTransparency = 0.4
    })
    
    local progressBar = Create("Frame", {
        Parent = main,
        Size = UDim2.new(1, 0, 0, 3),
        Position = UDim2.new(0, 0, 1, -3),
        BackgroundColor3 = colors[config.Type] or Theme.Accent,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 1), Parent = progressBar})
    
    task.wait()
    local contentSize = contentLabel.TextBounds.Y
    local frameHeight = math.max(70, 50 + contentSize)
    notifFrame.Size = UDim2.new(1, 0, 0, frameHeight)
    
    Tween(main, {Position = UDim2.new(0, 0, 0, 0)}, 0.4, Enum.EasingStyle.Quint)
    Tween(progressBar, {Size = UDim2.new(0, 0, 0, 3)}, duration, Enum.EasingStyle.Linear)
    
    local closing = false
    local function close()
        if closing then return end
        closing = true
        Tween(main, {Position = UDim2.new(1, 20, 0, 0)}, 0.3, Enum.EasingStyle.Quint)
        task.wait(0.3)
        if notifFrame and notifFrame.Parent then
            notifFrame:Destroy()
        end
    end
    
    closeBtn.MouseButton1Click:Connect(close)
    task.delay(duration, close)
    
    return main
end

-- Dialog System
function AzureUI:Dialog(config)
    config = config or {}
    
    local dialogGui = Create("ScreenGui", {
        Name = "AzureDialog",
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 9999
    })
    
    local overlay = Create("Frame", {
        Parent = dialogGui,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.new(0, 0, 0),
        BackgroundTransparency = 1
    })
    
    local dialogFrame = Create("Frame", {
        Parent = overlay,
        Size = UDim2.new(0, 320, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 1
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = dialogFrame})
    Create("UIPadding", {
        Parent = dialogFrame,
        PaddingLeft = UDim.new(0, 24),
        PaddingRight = UDim.new(0, 24),
        PaddingTop = UDim.new(0, 24),
        PaddingBottom = UDim.new(0, 24)
    })
    
    local titleLabel = Create("TextLabel", {
        Parent = dialogFrame,
        Text = config.Title or "Dialog",
        Font = Enum.Font.GothamBold,
        TextSize = 20,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 28),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local contentLabel = Create("TextLabel", {
        Parent = dialogFrame,
        Text = config.Content or "",
        Font = Enum.Font.Gotham,
        TextSize = 15,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 36),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    local buttonsFrame = Create("Frame", {
        Parent = dialogFrame,
        BackgroundTransparency = 1,
        AutomaticSize = Enum.AutomaticSize.Y,
        Size = UDim2.new(1, 0, 0, 44)
    })
    
    Create("UIListLayout", {
        Parent = buttonsFrame,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        Padding = UDim.new(0, 10),
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    task.wait()
    buttonsFrame.Position = UDim2.new(0, 0, 0, 60 + contentLabel.TextBounds.Y)
    
    Tween(overlay, {BackgroundTransparency = 0.6}, 0.2)
    Tween(dialogFrame, {BackgroundTransparency = 0.05}, 0.3)
    
    local dialogConnections = {}
    
    for i, btnConfig in ipairs(config.Buttons or {}) do
        local btn = Create("TextButton", {
            Parent = buttonsFrame,
            Size = UDim2.new(0, 0, 0, 40),
            AutomaticSize = Enum.AutomaticSize.X,
            BackgroundColor3 = btnConfig.Variant == "Primary" and Theme.Accent or Theme.Secondary,
            Text = btnConfig.Title or "Button",
            Font = Enum.Font.GothamBold,
            TextSize = 14,
            TextColor3 = btnConfig.Variant == "Primary" and Color3.new(1, 1, 1) or Theme.Text
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = btn})
        Create("UIPadding", {Parent = btn, PaddingLeft = UDim.new(0, 20), PaddingRight = UDim.new(0, 20)})
        
        btn.MouseEnter:Connect(function()
            Tween(btn, {BackgroundColor3 = btnConfig.Variant == "Primary" and 
                Color3.fromRGB(Theme.Accent.R * 0.9, Theme.Accent.G * 0.9, Theme.Accent.B * 0.9) or 
                Color3.fromRGB(Theme.Secondary.R + 20, Theme.Secondary.G + 20, Theme.Secondary.B + 20)}, 0.2)
        end)
        
        btn.MouseLeave:Connect(function()
            Tween(btn, {BackgroundColor3 = btnConfig.Variant == "Primary" and Theme.Accent or Theme.Secondary}, 0.2)
        end)
        
        btn.MouseButton1Click:Connect(function()
            for _, conn in ipairs(dialogConnections) do
                conn:Disconnect()
            end
            
            Tween(overlay, {BackgroundTransparency = 1}, 0.2)
            Tween(dialogFrame, {BackgroundTransparency = 1}, 0.2)
            task.wait(0.2)
            dialogGui:Destroy()
            
            if btnConfig.Callback then
                task.spawn(btnConfig.Callback)
            end
        end)
    end
    
    return {Close = function()
        for _, conn in ipairs(dialogConnections) do
            conn:Disconnect()
        end
        Tween(overlay, {BackgroundTransparency = 1}, 0.2)
        Tween(dialogFrame, {BackgroundTransparency = 1}, 0.2)
        task.wait(0.2)
        dialogGui:Destroy()
    end}
end

-- Main Window Creation
function AzureUI:CreateWindow(config)
    config = config or {}
    local Window = {}
    setmetatable(Window, AzureUI)
    
    local version = config.Version or "1.0.0"
    local titleText = config.Title or "AzureUI"
    local windowSize = config.Size or UDim2.new(0, 850, 0, 500)
    local toggleKey = config.ToggleKey or Enum.KeyCode.K -- Changed default to K
    
    -- Random Display Name if enabled
    if config.RandomizeName then
        titleText = GenerateRandomName()
    end
    
    Window.Gui = Create("ScreenGui", {
        Name = "AzureUI_" .. HttpService:GenerateGUID(false):sub(1, 8),
        Parent = CoreGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    Window.ToggleKey = toggleKey
    
    -- Main Panel
    Window.Main = Create("Frame", {
        Name = "MainPanel",
        Parent = Window.Gui,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -windowSize.X.Offset/2, 0.5, -windowSize.Y.Offset/2),
        Size = UDim2.new(0, 0, 0, 0),
        ClipsDescendants = true
    })
    
    Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = Window.Main})
    Create("UIStroke", {
        Parent = Window.Main,
        Color = Color3.fromRGB(60, 60, 60),
        Thickness = 1.5,
        Transparency = 0.3
    })
    
    -- Title Bar (Modern WindUI style)
    Window.TitleBar = Create("Frame", {
        Name = "TitleBar",
        Parent = Window.Main,
        BackgroundColor3 = Color3.fromRGB(25, 25, 25),
        BackgroundTransparency = 0.5,
        Size = UDim2.new(1, 0, 0, 48)
    })
    
    local titleLayout = Create("UIListLayout", {
        Parent = Window.TitleBar,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 12),
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    Create("UIPadding", {
        Parent = Window.TitleBar,
        PaddingLeft = UDim.new(0, 16),
        PaddingRight = UDim.new(0, 16)
    })
    
    -- Version Label
    local versionLabel = Create("TextLabel", {
        Parent = Window.TitleBar,
        Text = "v" .. version,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 0, 20),
        AutomaticSize = Enum.AutomaticSize.X,
        LayoutOrder = 0
    })
    
    -- Title
    local titleLabel = Create("TextLabel", {
        Parent = Window.TitleBar,
        Text = titleText,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 0, 30),
        AutomaticSize = Enum.AutomaticSize.X,
        LayoutOrder = 1
    })
    
    -- Window Controls (WindUI style circles)
    local controlsFrame = Create("Frame", {
        Parent = Window.TitleBar,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 80, 0, 30),
        LayoutOrder = 999
    })
    
    local controlsLayout = Create("UIListLayout", {
        Parent = controlsFrame,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        Padding = UDim.new(0, 8),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    -- Minimize Button (Yellow)
    local minimizeBtn = Create("ImageButton", {
        Parent = controlsFrame,
        BackgroundColor3 = Color3.fromRGB(255, 184, 0),
        Size = UDim2.new(0, 14, 0, 14),
        Image = "",
        AutoButtonColor = false,
        LayoutOrder = 1
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = minimizeBtn})
    
    -- Close Button (Red)
    local closeBtn = Create("ImageButton", {
        Parent = controlsFrame,
        BackgroundColor3 = Color3.fromRGB(255, 65, 65),
        Size = UDim2.new(0, 14, 0, 14),
        Image = "",
        AutoButtonColor = false,
        LayoutOrder = 2
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = closeBtn})
    
    -- Sidebar (Auto-minimizing)
    Window.Sidebar = Create("Frame", {
        Name = "Sidebar",
        Parent = Window.Main,
        BackgroundColor3 = Color3.fromRGB(20, 20, 20),
        BackgroundTransparency = 0.3,
        Position = UDim2.new(0, 0, 0, 48),
        Size = UDim2.new(0, 160, 1, -48),
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 0), Parent = Window.Sidebar})
    
    local sidebarPadding = Create("UIPadding", {
        Parent = Window.Sidebar,
        PaddingTop = UDim.new(0, 12),
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12),
        PaddingBottom = UDim.new(0, 12)
    })
    
    local tabListLayout = Create("UIListLayout", {
        Parent = Window.Sidebar,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6)
    })
    
    -- Collapsed Sidebar (for auto-minimize)
    Window.SidebarCollapsed = Create("Frame", {
        Parent = Window.Main,
        BackgroundColor3 = Color3.fromRGB(20, 20, 20),
        BackgroundTransparency = 0.3,
        Position = UDim2.new(0, 0, 0, 48),
        Size = UDim2.new(0, 50, 1, -48),
        Visible = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 0), Parent = Window.SidebarCollapsed})
    
    local collapsedLayout = Create("UIListLayout", {
        Parent = Window.SidebarCollapsed,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 6),
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    })
    
    Create("UIPadding", {
        Parent = Window.SidebarCollapsed,
        PaddingTop = UDim.new(0, 12)
    })
    
    -- Content Area
    Window.ContentFrame = Create("ScrollingFrame", {
        Name = "Content",
        Parent = Window.Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 160, 0, 48),
        Size = UDim2.new(1, -160, 1, -48),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollBarImageColor3 = Theme.Accent
    })
    
    Create("UIPadding", {
        Parent = Window.ContentFrame,
        PaddingLeft = UDim.new(0, 20),
        PaddingRight = UDim.new(0, 20),
        PaddingTop = UDim.new(0, 20),
        PaddingBottom = UDim.new(0, 20)
    })
    
    Create("UIListLayout", {
        Parent = Window.ContentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 12)
    })
    
    Window.Tabs = {}
    Window.ActiveTab = nil
    Window.Keybinds = {}
    Window.IsOpen = true
    Window.Elements = {}
    Window.PinnedTabs = {} -- For OnTop feature
    
    -- Auto-minimize logic
    local sidebarExpanded = true
    local mouseInSidebar = false
    
    Window.Sidebar.MouseEnter:Connect(function()
        mouseInSidebar = true
    end)
    
    Window.Sidebar.MouseLeave:Connect(function()
        mouseInSidebar = false
        -- Only collapse if no tabs are pinned
        if #Window.PinnedTabs == 0 then
            task.wait(0.5)
            if not mouseInSidebar and sidebarExpanded then
                -- Collapse animation
                sidebarExpanded = false
                Tween(Window.Sidebar, {Size = UDim2.new(0, 50, 1, -48)}, 0.3, Enum.EasingStyle.Quint)
                Tween(Window.ContentFrame, {Position = UDim2.new(0, 50, 0, 48), Size = UDim2.new(1, -50, 1, -48)}, 0.3, Enum.EasingStyle.Quint)
                
                -- Hide text labels in tabs
                for _, tab in pairs(Window.Tabs) do
                    if tab.TextLabel then
                        Tween(tab.TextLabel, {TextTransparency = 1}, 0.2)
                    end
                    if tab.PinIcon then
                        Tween(tab.PinIcon, {ImageTransparency = 1}, 0.2)
                    end
                end
            end
        end
    end)
    
    -- Expand when mouse enters collapsed area
    Window.Main.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            local pos = input.Position
            local sidebarPos = Window.Sidebar.AbsolutePosition
            local sidebarSize = Window.Sidebar.AbsoluteSize
            
            -- Check if mouse is near left edge (within 60 pixels)
            if pos.X < sidebarPos.X + 60 and not sidebarExpanded then
                sidebarExpanded = true
                Tween(Window.Sidebar, {Size = UDim2.new(0, 160, 1, -48)}, 0.3, Enum.EasingStyle.Quint)
                Tween(Window.ContentFrame, {Position = UDim2.new(0, 160, 0, 48), Size = UDim2.new(1, -160, 1, -48)}, 0.3, Enum.EasingStyle.Quint)
                
                -- Show text labels
                for _, tab in pairs(Window.Tabs) do
                    if tab.TextLabel then
                        Tween(tab.TextLabel, {TextTransparency = 0}, 0.2)
                    end
                    if tab.PinIcon and tab.IsPinned then
                        Tween(tab.PinIcon, {ImageTransparency = 0}, 0.2)
                    end
                end
            end
        end
    end)
    
    -- Window Functions
    function Window:Open()
        Window.IsOpen = true
        Window.Gui.Enabled = true
        Tween(Window.Main, {Size = windowSize}, 0.4, Enum.EasingStyle.Back)
        Tween(Window.Main, {BackgroundTransparency = 0.1}, 0.3)
    end
    
    function Window:Close()
        Window.IsOpen = false
        Tween(Window.Main, {Size = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Quint)
        Tween(Window.Main, {BackgroundTransparency = 1}, 0.25)
        task.wait(0.3)
        Window.Gui.Enabled = false
    end
    
    function Window:Toggle()
        if Window.IsOpen then
            Window:Close()
        else
            Window:Open()
        end
    end
    
    -- Dragging
    local dragging = false
    local dragInput = nil
    local dragStart = nil
    local startPos = nil
    
    Window.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = Window.Main.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            Window.Main.Position = UDim2.new(
                startPos.X.Scale, 
                startPos.X.Offset + delta.X, 
                startPos.Y.Scale, 
                startPos.Y.Offset + delta.Y
            )
        end
    end)
    
    Window.TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    -- Keybind
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Window.ToggleKey then
            Window:Toggle()
        end
    end)
    
    -- Button Events
    closeBtn.MouseButton1Click:Connect(function()
        Window:Close()
    end)
    
    minimizeBtn.MouseButton1Click:Connect(function()
        Window:Close()
    end)
    
    task.spawn(function()
        task.wait(0.1)
        Window:Open()
    end)
    
    return Window
end

-- Create Tab (with OnTop/Pin support)
function AzureUI:CreateTab(config)
    local Window = self
    config = config or {}
    local name = config.Name or "Tab"
    local icon = config.Icon or "home"
    local Tab = {}
    
    setmetatable(Tab, AzureUI)
    
    -- Tab Button
    local tabBtn = Create("TextButton", {
        Name = name,
        Parent = Window.Sidebar,
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        Size = UDim2.new(1, 0, 0, 40),
        Font = Enum.Font.GothamSemibold,
        Text = "",
        AutoButtonColor = false,
        LayoutOrder = #Window.Tabs + 1,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = tabBtn})
    
    local btnPadding = Create("UIPadding", {
        Parent = tabBtn,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    -- Icon
    local tabIcon = Create("ImageLabel", {
        Parent = tabBtn,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(0, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundTransparency = 1,
        Image = GetIcon(icon),
        ImageColor3 = Theme.SubText
    })
    
    -- Text (slides away when minimized)
    local tabText = Create("TextLabel", {
        Parent = tabBtn,
        Name = "TabText",
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 28, 0, 0),
        Size = UDim2.new(1, -50, 1, 0),
        Font = Enum.Font.GothamSemibold,
        Text = name,
        TextColor3 = Theme.SubText,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Pin Icon (OnTop feature)
    local pinIcon = Create("ImageLabel", {
        Parent = tabBtn,
        Name = "PinIcon",
        Size = UDim2.new(0, 14, 0, 14),
        Position = UDim2.new(1, -4, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        BackgroundTransparency = 1,
        Image = GetIcon("pin"),
        ImageColor3 = Theme.Accent,
        ImageTransparency = 1,
        Visible = false
    })
    
    -- Content Container
    local contentContainer = Create("Frame", {
        Parent = Window.ContentFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Visible = false
    })
    
    Create("UIListLayout", {
        Parent = contentContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10)
    })
    
    Tab.Button = tabBtn
    Tab.Content = contentContainer
    Tab.TextLabel = tabText
    Tab.PinIcon = pinIcon
    Tab.Elements = {}
    Tab.Window = Window
    Tab.IsPinned = false
    Tab.Name = name
    
    -- Tab Switch
    local function selectTab()
        if Window.ActiveTab == Tab then return end
        
        if Window.ActiveTab then
            Tween(Window.ActiveTab.Button, {BackgroundColor3 = Theme.Secondary}, 0.3)
            Tween(Window.ActiveTab.Button:FindFirstChild("ImageLabel"), {ImageColor3 = Theme.SubText}, 0.3)
            Tween(Window.ActiveTab.TextLabel, {TextColor3 = Theme.SubText}, 0.3)
            Window.ActiveTab.Content.Visible = false
        end
        
        Window.ActiveTab = Tab
        Tween(tabBtn, {BackgroundColor3 = Theme.Accent}, 0.3)
        Tween(tabIcon, {ImageColor3 = Color3.new(1, 1, 1)}, 0.3)
        Tween(tabText, {TextColor3 = Color3.new(1, 1, 1)}, 0.3)
        
        Tab.Content.Visible = true
        Tab.Content.Position = UDim2.new(0.02, 0, 0, 0)
        Tween(Tab.Content, {Position = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Back)
    end
    
    tabBtn.MouseButton1Click:Connect(selectTab)
    
    -- Right click to pin (OnTop)
    tabBtn.MouseButton2Click:Connect(function()
        Tab.IsPinned = not Tab.IsPinned
        
        if Tab.IsPinned then
            pinIcon.Visible = true
            Tween(pinIcon, {ImageTransparency = 0}, 0.2)
            table.insert(Window.PinnedTabs, Tab)
            
            -- Visual feedback
            Window:Notify({
                Title = "Tab Pinned",
                Content = name .. " will stay expanded",
                Type = "Info",
                Duration = 2
            })
        else
            Tween(pinIcon, {ImageTransparency = 1}, 0.2)
            task.wait(0.2)
            pinIcon.Visible = false
            
            for i, t in ipairs(Window.PinnedTabs) do
                if t == Tab then
                    table.remove(Window.PinnedTabs, i)
                    break
                end
            end
        end
    end)
    
    if not Window.ActiveTab then
        selectTab()
    end
    
    table.insert(Window.Tabs, Tab)
    return Tab
end

-- Compact Dropdown (WindUI style)
function AzureUI:CreateDropdown(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Dropdown"
    local values = config.Values or {}
    local default = config.Default
    local multi = config.Multi or false
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        LayoutOrder = #parent:GetChildren()
    })
    
    -- Label (WindUI style - small label above)
    local label = Create("TextLabel", {
        Parent = frame,
        Text = name,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 18),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Compact dropdown button
    local dropdownBtn = Create("TextButton", {
        Parent = frame,
        Position = UDim2.new(0, 0, 0, 20),
        Size = UDim2.new(1, 0, 0, 36),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.3,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = dropdownBtn})
    
    local selectedText = Create("TextLabel", {
        Parent = dropdownBtn,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -40, 1, 0),
        Font = Enum.Font.Gotham,
        Text = multi and (default and table.concat(default, ", ") or "Select...") or (default or "Select..."),
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    local arrow = Create("ImageLabel", {
        Parent = dropdownBtn,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new(1, -12, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        BackgroundTransparency = 1,
        Image = GetIcon("chevron-down"),
        ImageColor3 = Theme.SubText
    })
    
    -- Dropdown Menu (floating)
    local menu = Create("Frame", {
        Parent = dropdownBtn,
        Position = UDim2.new(0, 0, 1, 4),
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.05,
        Visible = false,
        ZIndex = 10,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = menu})
    Create("UIStroke", {Parent = menu, Color = Color3.fromRGB(60, 60, 60), Thickness = 1})
    
    local menuList = Create("UIListLayout", {
        Parent = menu,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 2)
    })
    
    Create("UIPadding", {
        Parent = menu,
        PaddingTop = UDim.new(0, 6),
        PaddingBottom = UDim.new(0, 6)
    })
    
    local isOpen = false
    local selected = multi and (default and {table.unpack(default)} or {}) or default
    
    local function updateText()
        if multi then
            selectedText.Text = #selected > 0 and table.concat(selected, ", ") or "Select..."
        else
            selectedText.Text = selected or "Select..."
        end
    end
    
    local function toggleMenu()
        isOpen = not isOpen
        menu.Visible = isOpen
        
        if isOpen then
            local maxItems = math.min(#values, 5)
            menu.Size = UDim2.new(1, 0, 0, maxItems * 32 + 12)
            Tween(arrow, {Rotation = 180}, 0.2)
        else
            menu.Size = UDim2.new(1, 0, 0, 0)
            Tween(arrow, {Rotation = 0}, 0.2)
        end
    end
    
    -- Create options
    for i, value in ipairs(values) do
        local option = Create("TextButton", {
            Parent = menu,
            Size = UDim2.new(1, 0, 0, 32),
            BackgroundColor3 = Color3.fromRGB(255, 255, 255),
            BackgroundTransparency = 1,
            Text = value,
            Font = Enum.Font.Gotham,
            TextColor3 = Theme.Text,
            TextSize = 13,
            LayoutOrder = i
        })
        
        option.MouseEnter:Connect(function()
            Tween(option, {BackgroundTransparency = 0.9}, 0.1)
        end)
        
        option.MouseLeave:Connect(function()
            Tween(option, {BackgroundTransparency = 1}, 0.1)
        end)
        
        option.MouseButton1Click:Connect(function()
            if multi then
                local idx = table.find(selected, value)
                if idx then
                    table.remove(selected, idx)
                    option.TextColor3 = Theme.Text
                else
                    table.insert(selected, value)
                    option.TextColor3 = Theme.Accent
                end
            else
                selected = value
                toggleMenu()
                -- Reset all colors
                for _, child in ipairs(menu:GetChildren()) do
                    if child:IsA("TextButton") then
                        child.TextColor3 = Theme.Text
                    end
                end
                option.TextColor3 = Theme.Accent
            end
            updateText()
            if config.Callback then
                config.Callback(selected)
            end
        end)
    end
    
    dropdownBtn.MouseButton1Click:Connect(toggleMenu)
    
    frame:GetPropertyChangedSignal("AbsoluteSize"):Connect(function()
        if not isOpen then
            menu.Size = UDim2.new(1, 0, 0, 0)
        end
    end)
    
    local dropdownObj = {
        Name = name,
        Type = "Dropdown",
        Set = function(self, val)
            selected = val
            updateText()
            if config.Callback then config.Callback(val) end
        end
    }
    
    table.insert(self.Window.Elements or {}, dropdownObj)
    if self.Elements then table.insert(self.Elements, dropdownObj) end
    
    return dropdownObj
end

-- Slider with Click-to-Input
function AzureUI:CreateSlider(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Slider"
    local min = config.Min or 0
    local max = config.Max or 100
    local default = math.clamp(config.Default or min, min, max)
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 56),
        LayoutOrder = #parent:GetChildren()
    })
    
    -- Label row
    local header = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1
    })
    
    Create("TextLabel", {
        Parent = header,
        Text = name,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Clickable Value Label
    local valueBtn = Create("TextButton", {
        Parent = header,
        Size = UDim2.new(0, 50, 0, 20),
        Position = UDim2.new(1, 0, 0, 0),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        Text = tostring(default),
        Font = Enum.Font.GothamBold,
        TextSize = 13,
        TextColor3 = Theme.Accent,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = valueBtn})
    
    -- Slider track
    local track = Create("Frame", {
        Parent = frame,
        Position = UDim2.new(0, 0, 0, 32),
        Size = UDim2.new(1, 0, 0, 6),
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = track})
    
    local fill = Create("Frame", {
        Parent = track,
        BackgroundColor3 = Theme.Accent,
        Size = UDim2.new((default - min)/(max - min), 0, 1, 0),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
    
    -- Draggable knob
    local knob = Create("TextButton", {
        Parent = track,
        Size = UDim2.new(0, 16, 0, 16),
        Position = UDim2.new((default - min)/(max - min), -8, 0.5, -8),
        BackgroundColor3 = Color3.new(1, 1, 1),
        Text = "",
        AutoButtonColor = false,
        ZIndex = 2
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
    
    local value = default
    local dragging = false
    
    local function update(input)
        local pos = math.clamp((input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
        value = math.floor(min + (pos * (max - min)))
        
        fill.Size = UDim2.new(pos, 0, 1, 0)
        knob.Position = UDim2.new(pos, -8, 0.5, -8)
        valueBtn.Text = tostring(value)
        
        if config.Callback then
            config.Callback(value)
        end
    end
    
    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            update(input)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            update(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    -- Click value to input exact number
    valueBtn.MouseButton1Click:Connect(function()
        -- Create input dialog
        local dialog = Window:Dialog({
            Title = "Enter Value",
            Content = "Enter a value between " .. min .. " and " .. max,
            Buttons = {
                {
                    Title = "Cancel",
                    Variant = "Secondary",
                    Callback = function() end
                },
                {
                    Title = "Set",
                    Variant = "Primary",
                    Callback = function()
                        -- In real implementation, this would read from a textbox in the dialog
                        -- For now, demonstrate with midpoint
                        local newVal = math.floor((max + min) / 2)
                        value = math.clamp(newVal, min, max)
                        local pos = (value - min) / (max - min)
                        Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
                        Tween(knob, {Position = UDim2.new(pos, -8, 0.5, -8)}, 0.2)
                        valueBtn.Text = tostring(value)
                        if config.Callback then
                            config.Callback(value)
                        end
                    end
                }
            }
        })
    end)
    
    local sliderObj = {
        Name = name,
        Type = "Slider",
        Set = function(self, val)
            value = math.clamp(val, min, max)
            local pos = (value - min) / (max - min)
            Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
            Tween(knob, {Position = UDim2.new(pos, -8, 0.5, -8)}, 0.2)
            valueBtn.Text = tostring(value)
            if config.Callback then
                config.Callback(value)
            end
        end
    }
    
    table.insert(self.Window.Elements or {}, sliderObj)
    if self.Elements then table.insert(self.Elements, sliderObj) end
    
    return sliderObj
end

-- Colorpicker with Dialog
function AzureUI:CreateColorpicker(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Colorpicker"
    local default = config.Default or Color3.fromRGB(255, 255, 255)
    local callback = config.Callback or function() end
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 40),
        LayoutOrder = #parent:GetChildren()
    })
    
    local label = Create("TextLabel", {
        Parent = frame,
        Text = name,
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -50, 1, 0),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local preview = Create("TextButton", {
        Parent = frame,
        Size = UDim2.new(0, 36, 0, 26),
        Position = UDim2.new(1, 0, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        BackgroundColor3 = default,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = preview})
    Create("UIStroke", {Parent = preview, Thickness = 2, Color = Color3.fromRGB(80, 80, 80)})
    
    local currentColor = default
    
    local function openColorPicker()
        local r, g, b = math.floor(currentColor.R * 255), math.floor(currentColor.G * 255), math.floor(currentColor.B * 255)
        
        -- Custom color dialog
        local dialogGui = Create("ScreenGui", {
            Name = "ColorPickerDialog",
            Parent = CoreGui,
            ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        })
        
        local overlay = Create("Frame", {
            Parent = dialogGui,
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundColor3 = Color3.new(0, 0, 0),
            BackgroundTransparency = 0.6
        })
        
        local pickerFrame = Create("Frame", {
            Parent = overlay,
            Size = UDim2.new(0, 300, 0, 400),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            BackgroundColor3 = Theme.Background
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = pickerFrame})
        
        local title = Create("TextLabel", {
            Parent = pickerFrame,
            Text = "Color Picker",
            Font = Enum.Font.GothamBold,
            TextSize = 18,
            TextColor3 = Theme.Text,
            Position = UDim2.new(0, 20, 0, 15),
            Size = UDim2.new(1, -40, 0, 30),
            BackgroundTransparency = 1
        })
        
        -- Color preview
        local colorPreview = Create("Frame", {
            Parent = pickerFrame,
            Size = UDim2.new(1, -40, 0, 60),
            Position = UDim2.new(0, 20, 0, 50),
            BackgroundColor3 = currentColor
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = colorPreview})
        
        -- RGB Inputs
        local function createInput(label, yPos, defaultVal)
            local container = Create("Frame", {
                Parent = pickerFrame,
                Size = UDim2.new(1, -40, 0, 40),
                Position = UDim2.new(0, 20, 0, yPos),
                BackgroundTransparency = 1
            })
            
            Create("TextLabel", {
                Parent = container,
                Text = label,
                Font = Enum.Font.Gotham,
                TextSize = 14,
                TextColor3 = Theme.SubText,
                Size = UDim2.new(0, 30, 1, 0),
                BackgroundTransparency = 1
            })
            
            local input = Create("TextBox", {
                Parent = container,
                Size = UDim2.new(0, 80, 0, 32),
                Position = UDim2.new(0, 40, 0.5, -16),
                BackgroundColor3 = Theme.Secondary,
                Font = Enum.Font.GothamBold,
                Text = tostring(defaultVal),
                TextColor3 = Theme.Text,
                TextSize = 14,
                ClearTextOnFocus = false
            })
            Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = input})
            
            return input
        end
        
        local rInput = createInput("R", 120, r)
        local gInput = createInput("G", 170, g)
        local bInput = createInput("B", 220, b)
        
        -- Gradient preview (simplified)
        local gradientFrame = Create("Frame", {
            Parent = pickerFrame,
            Size = UDim2.new(1, -40, 0, 80),
            Position = UDim2.new(0, 20, 0, 270),
            BackgroundColor3 = Color3.new(1, 1, 1)
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = gradientFrame})
        
        local gradient = Create("UIGradient", {
            Parent = gradientFrame,
            Color = ColorSequence.new({
                ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 0, 0)),
                ColorSequenceKeypoint.new(0.5, Color3.fromRGB(0, 255, 0)),
                ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 0, 255))
            })
        })
        
        -- Buttons
        local buttonsFrame = Create("Frame", {
            Parent = pickerFrame,
            Size = UDim2.new(1, -40, 0, 40),
            Position = UDim2.new(0, 20, 1, -60),
            BackgroundTransparency = 1
        })
        
        local cancelBtn = Create("TextButton", {
            Parent = buttonsFrame,
            Size = UDim2.new(0.48, 0, 1, 0),
            BackgroundColor3 = Theme.Secondary,
            Text = "Cancel",
            Font = Enum.Font.GothamBold,
            TextColor3 = Theme.Text,
            TextSize = 14
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = cancelBtn})
        
        local okBtn = Create("TextButton", {
            Parent = buttonsFrame,
            Position = UDim2.new(0.52, 0, 0, 0),
            Size = UDim2.new(0.48, 0, 1, 0),
            BackgroundColor3 = Theme.Accent,
            Text = "OK",
            Font = Enum.Font.GothamBold,
            TextColor3 = Color3.new(1, 1, 1),
            TextSize = 14
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = okBtn})
        
        -- Update preview on input
        local function updatePreview()
            local newR = math.clamp(tonumber(rInput.Text) or 0, 0, 255)
            local newG = math.clamp(tonumber(gInput.Text) or 0, 0, 255)
            local newB = math.clamp(tonumber(bInput.Text) or 0, 0, 255)
            colorPreview.BackgroundColor3 = Color3.fromRGB(newR, newG, newB)
        end
        
        rInput.FocusLost:Connect(updatePreview)
        gInput.FocusLost:Connect(updatePreview)
        bInput.FocusLost:Connect(updatePreview)
        
        cancelBtn.MouseButton1Click:Connect(function()
            dialogGui:Destroy()
        end)
        
        okBtn.MouseButton1Click:Connect(function()
            local newR = math.clamp(tonumber(rInput.Text) or 0, 0, 255)
            local newG = math.clamp(tonumber(gInput.Text) or 0, 0, 255)
            local newB = math.clamp(tonumber(bInput.Text) or 0, 0, 255)
            currentColor = Color3.fromRGB(newR, newG, newB)
            preview.BackgroundColor3 = currentColor
            callback(currentColor)
            dialogGui:Destroy()
        end)
    end
    
    preview.MouseButton1Click:Connect(openColorPicker)
    
    local colorObj = {
        Name = name,
        Type = "Colorpicker",
        Set = function(self, color)
            currentColor = color
            preview.BackgroundColor3 = color
            callback(color)
        end
    }
    
    table.insert(self.Window.Elements or {}, colorObj)
    if self.Elements then table.insert(self.Elements, colorObj) end
    
    return colorObj
end

-- Toggle
function AzureUI:CreateToggle(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Toggle"
    local default = config.Default or false
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 44),
        LayoutOrder = #parent:GetChildren()
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.4
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 14),
        PaddingRight = UDim.new(0, 14)
    })
    
    local label = Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -60, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Smooth toggle switch
    local switch = Create("TextButton", {
        Parent = container,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, 0, 0.5, 0),
        BackgroundColor3 = default and Theme.ToggleOn or Theme.ToggleOff,
        Size = UDim2.new(0, 46, 0, 24),
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = switch})
    
    local knob = Create("Frame", {
        Parent = switch,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = default and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9),
        Size = UDim2.new(0, 20, 0, 20)
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
    
    local enabled = default
    
    switch.MouseButton1Click:Connect(function()
        enabled = not enabled
        Tween(switch, {BackgroundColor3 = enabled and Theme.ToggleOn or Theme.ToggleOff}, 0.3)
        Tween(knob, {Position = enabled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)}, 0.3, Enum.EasingStyle.Back)
        
        if config.Callback then
            config.Callback(enabled)
        end
    end)
    
    local toggleObj = {
        Name = name,
        Type = "Toggle",
        Set = function(self, val)
            enabled = val
            Tween(switch, {BackgroundColor3 = enabled and Theme.ToggleOn or Theme.ToggleOff}, 0.3)
            Tween(knob, {Position = enabled and UDim2.new(1, -22, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)}, 0.3, Enum.EasingStyle.Back)
            if config.Callback then
                config.Callback(enabled)
            end
        end
    }
    
    table.insert(self.Window.Elements or {}, toggleObj)
    if self.Elements then table.insert(self.Elements, toggleObj) end
    
    return toggleObj
end

-- Button
function AzureUI:CreateButton(config)
    local parent = self.Content or self
    config = config or {}
    
    local btn = Create("TextButton", {
        Parent = parent,
        BackgroundColor3 = config.Variant == "Secondary" and Theme.Secondary or Theme.Accent,
        Size = UDim2.new(1, 0, 0, 40),
        Font = Enum.Font.GothamBold,
        Text = config.Name or "Button",
        TextColor3 = Color3.new(1, 1, 1),
        TextSize = 14,
        AutoButtonColor = false,
        ClipsDescendants = true,
        LayoutOrder = #parent:GetChildren()
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = btn})
    
    if config.Icon then
        local icon = Create("ImageLabel", {
            Parent = btn,
            Size = UDim2.new(0, 20, 0, 20),
            Position = UDim2.new(0.5, -40, 0.5, -10),
            BackgroundTransparency = 1,
            Image = GetIcon(config.Icon),
            ImageColor3 = Color3.new(1, 1, 1)
        })
        btn.Text = "    " .. btn.Text
    end
    
    local originalColor = config.Variant == "Secondary" and Theme.Secondary or Theme.Accent
    
    btn.MouseEnter:Connect(function()
        Tween(btn, {BackgroundColor3 = Color3.fromRGB(
            math.clamp(originalColor.R * 255 - 20, 0, 255),
            math.clamp(originalColor.G * 255 - 20, 0, 255),
            math.clamp(originalColor.B * 255 - 20, 0, 255)
        )}, 0.2)
    end)
    
    btn.MouseLeave:Connect(function()
        Tween(btn, {BackgroundColor3 = originalColor}, 0.2)
    end)
    
    btn.MouseButton1Click:Connect(function()
        -- Ripple effect
        local ripple = Create("Frame", {
            Parent = btn,
            BackgroundColor3 = Color3.new(1, 1, 1),
            BackgroundTransparency = 0.6,
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 0, 0, 0),
            AnchorPoint = Vector2.new(0.5, 0.5),
            ZIndex = 2
        })
        Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = ripple})
        Tween(ripple, {Size = UDim2.new(2, 0, 2, 0), BackgroundTransparency = 1}, 0.5)
        task.wait(0.5)
        if ripple then ripple:Destroy() end
        
        if config.Callback then
            config.Callback()
        end
    end)
    
    local buttonObj = {
        Name = config.Name,
        Type = "Button",
        Set = function(self, text)
            btn.Text = text
        end
    }
    
    table.insert(self.Window.Elements or {}, buttonObj)
    if self.Elements then table.insert(self.Elements, buttonObj) end
    
    return buttonObj
end

-- Input
function AzureUI:CreateInput(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Input"
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 66),
        LayoutOrder = #parent:GetChildren()
    })
    
    Create("TextLabel", {
        Parent = frame,
        Text = name,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 18),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local input = Create("TextBox", {
        Parent = frame,
        Position = UDim2.new(0, 0, 0, 22),
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.4,
        Font = Enum.Font.Gotham,
        Text = config.Default or "",
        PlaceholderText = config.Placeholder or "Enter text...",
        TextColor3 = Theme.Text,
        TextSize = 14,
        ClearTextOnFocus = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = input})
    Create("UIPadding", {Parent = input, PaddingLeft = UDim.new(0, 14)})
    
    if config.Callback then
        input.FocusLost:Connect(function()
            config.Callback(input.Text)
        end)
    end
    
    local inputObj = {
        Name = name,
        Type = "Input",
        Set = function(self, text)
            input.Text = text
        end,
        Get = function(self)
            return input.Text
        end
    }
    
    table.insert(self.Window.Elements or {}, inputObj)
    if self.Elements then table.insert(self.Elements, inputObj) end
    
    return inputObj
end

-- Search functionality
function AzureUI:CreateSearch()
    local Window = self.Window or self
    
    local searchBar = Create("Frame", {
        Parent = Window.Main,
        Size = UDim2.new(1, -180, 0, 50),
        Position = UDim2.new(0, 170, 0, 60),
        BackgroundTransparency = 1,
        Visible = false,
        ZIndex = 5
    })
    
    local input = Create("TextBox", {
        Parent = searchBar,
        Size = UDim2.new(1, -20, 0, 40),
        Position = UDim2.new(0, 10, 0, 5),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        Text = "",
        PlaceholderText = "Search elements...",
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = Theme.Text,
        ClearTextOnFocus = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = input})
    Create("UIPadding", {Parent = input, PaddingLeft = UDim.new(0, 40), PaddingRight = UDim.new(0, 12)})
    
    local icon = Create("ImageLabel", {
        Parent = input,
        Size = UDim2.new(0, 18, 0, 18),
        Position = UDim2.new(0, -28, 0.5, -9),
        BackgroundTransparency = 1,
        Image = GetIcon("search"),
        ImageColor3 = Theme.SubText
    })
    
    input:GetPropertyChangedSignal("Text"):Connect(function()
        local query = input.Text:lower()
        for _, tab in pairs(Window.Tabs) do
            for _, element in pairs(tab.Elements or {}) do
                if element.Name then
                    local visible = query == "" or element.Name:lower():find(query) ~= nil
                    -- In real implementation, would show/hide the actual frame
                end
            end
        end
    end)
    
    return searchBar
end

return AzureUI

--[[
    AzureUI v5.0 - Ultimate Hybrid UI Library
    Lines: 2500+ | Features: Icon System, Advance Mode, Dynamic Layouts, Enhanced Animations
    Credits: WindUI + Sirius Hybrid Architecture
]]

local AzureUI = {}
AzureUI.__index = AzureUI

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local TextService = game:GetService("TextService")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- ============================================
-- UTILITY FUNCTIONS
-- ============================================

local function GenerateRandomName()
    local chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
    local name = ""
    for i = 1, math.random(10, 16) do
        name = name .. chars:sub(math.random(1, #chars), math.random(1, #chars))
    end
    return name
end

local function Create(instanceType, properties)
    local instance = Instance.new(instanceType)
    for prop, value in pairs(properties or {}) do
        instance[prop] = value
    end
    return instance
end

local function Tween(instance, properties, duration, easingStyle, easingDirection, callback)
    local tweenInfo = TweenInfo.new(
        duration or 0.3, 
        easingStyle or Enum.EasingStyle.Quart, 
        easingDirection or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tweenInfo, properties)
    if callback then
        tween.Completed:Connect(callback)
    end
    tween:Play()
    return tween
end

local function Ripple(button, color)
    local ripple = Create("Frame", {
        Parent = button,
        BackgroundColor3 = color or Color3.new(1, 1, 1),
        BackgroundTransparency = 0.7,
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(0, 0, 0, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        ZIndex = button.ZIndex + 1
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = ripple})
    Tween(ripple, {Size = UDim2.new(2.5, 0, 2.5, 0), BackgroundTransparency = 1}, 0.6, Enum.EasingStyle.Quad)
    task.delay(0.6, function()
        if ripple and ripple.Parent then ripple:Destroy() end
    end)
end

local function GetTextBounds(text, font, size, maxWidth)
    return TextService:GetTextSize(text, size, font, Vector2.new(maxWidth or 1000, 1000))
end

-- ============================================
-- ICON MODULE SYSTEM
-- ============================================

local IconModule = {}
IconModule.__index = IconModule

function IconModule.Init()
    local self = setmetatable({}, IconModule)
    self.IconsType = "lucide"
    self.New = nil
    self.IconThemeTag = nil
    
    -- Load icon packs asynchronously with caching
    self.Icons = {}
    self.LoadedPacks = {}
    
    -- Fallback icon data in case loading fails
    self.FallbackIcons = {
        lucide = {
            home = "rbxassetid://7733963888",
            settings = "rbxassetid://7733973200",
            user = "rbxassetid://7733970256",
            menu = "rbxassetid://7733901624",
            check = "rbxassetid://7733710700",
            ["chevron-down"] = "rbxassetid://7733715403",
            ["chevron-up"] = "rbxassetid://7733712849",
            ["chevron-right"] = "rbxassetid://7733714999",
            ["chevron-left"] = "rbxassetid://7733714583",
            x = "rbxassetid://7733658504",
            minus = "rbxassetid://7733764353",
            bell = "rbxassetid://7733673125",
            info = "rbxassetid://7733954058",
            search = "rbxassetid://7733955854",
            copy = "rbxassetid://7733764083",
            palette = "rbxassetid://7733946818",
            sliders = "rbxassetid://7733970821",
            terminal = "rbxassetid://7733975249",
            image = "rbxassetid://7733940695",
            lock = "rbxassetid://7733940867",
            unlock = "rbxassetid://7734016034",
            key = "rbxassetid://7733778987",
            moon = "rbxassetid://7733954468",
            sun = "rbxassetid://7733978098",
            maximize = "rbxassetid://7733954206",
            move = "rbxassetid://7733949600",
            ["log-out"] = "rbxassetid://7733779730",
            ["arrow-right"] = "rbxassetid://7733671454",
            ["arrow-up"] = "rbxassetid://7733671593",
            eye = "rbxassetid://7733942654",
            repeat_icon = "rbxassetid://7733970711",
            save = "rbxassetid://7733955749",
            pin = "rbxassetid://7733947956",
            hash = "rbxassetid://7733940225",
            clock = "rbxassetid://7733764083",
            calendar = "rbxassetid://7733676038",
            star = "rbxassetid://7733976987",
            heart = "rbxassetid://7733954763",
            shield = "rbxassetid://7733964698",
            zap = "rbxassetid://7733992152",
            target = "rbxassetid://7733978991"
        }
    }
    
    self:LoadIconPack("lucide")
    return self
end

function IconModule:LoadIconPack(packName)
    if self.LoadedPacks[packName] then return end
    
    local success, result = pcall(function()
        -- In a real implementation, these would load from URLs
        -- For now, we use fallback data
        return self.FallbackIcons[packName] or {}
    end)
    
    if success then
        self.Icons[packName] = result
        self.LoadedPacks[packName] = true
    else
        warn("Failed to load icon pack: " .. packName)
        self.Icons[packName] = {}
    end
end

function IconModule:SetIconsType(iconType)
    self.IconsType = iconType
    if not self.LoadedPacks[iconType] then
        self:LoadIconPack(iconType)
    end
end

function IconModule:ParseIconString(iconString)
    if type(iconString) == "string" then
        local splitIndex = iconString:find(":")
        if splitIndex then
            local iconType = iconString:sub(1, splitIndex - 1)
            local iconName = iconString:sub(splitIndex + 1)
            return iconType, iconName
        end
    end
    return nil, iconString
end

function IconModule:GetIcon(iconString, specificType)
    local iconType, iconName = self:ParseIconString(iconString)
    local targetType = iconType or specificType or self.IconsType
    
    if not self.LoadedPacks[targetType] then
        self:LoadIconPack(targetType)
    end
    
    local pack = self.Icons[targetType]
    if pack and pack[iconName] then
        return pack[iconName]
    end
    
    -- Return fallback
    return self.FallbackIcons.lucide[iconName] or self.FallbackIcons.lucide["menu"]
end

function IconModule:CreateIcon(iconConfig)
    local config = iconConfig or {}
    local iconName = config.Icon or "menu"
    local iconType = config.Type or self.IconsType
    local size = config.Size or UDim2.new(0, 24, 0, 24)
    local color = config.Color or Color3.new(1, 1, 1)
    
    local iconImage = self:GetIcon(iconName, iconType)
    
    local iconLabel = Create("ImageLabel", {
        Size = size,
        BackgroundTransparency = 1,
        Image = iconImage,
        ImageColor3 = color,
        ImageTransparency = config.Transparency or 0
    })
    
    if config.ThemeTag then
        -- Apply theme tagging logic if using advanced theming
        iconLabel:SetAttribute("ThemeTag", config.ThemeTag)
    end
    
    return iconLabel
end

-- Global Icon Manager
local IconManager = IconModule.Init()

-- ============================================
-- THEME SYSTEM
-- ============================================

local Themes = {
    Dark = {
        Background = Color3.fromRGB(18, 18, 18),
        Accent = Color3.fromRGB(88, 101, 242),
        Secondary = Color3.fromRGB(30, 30, 30),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(175, 175, 175),
        ToggleOn = Color3.fromRGB(88, 101, 242),
        ToggleOff = Color3.fromRGB(60, 60, 60),
        CornerRadius = UDim.new(0, 12),
        Shadow = Color3.fromRGB(0, 0, 0),
        ElementBackground = Color3.fromRGB(25, 25, 25),
        Hover = Color3.fromRGB(40, 40, 40),
        Border = Color3.fromRGB(60, 60, 60)
    },
    Light = {
        Background = Color3.fromRGB(245, 245, 245),
        Accent = Color3.fromRGB(59, 130, 246),
        Secondary = Color3.fromRGB(220, 220, 220),
        Text = Color3.fromRGB(30, 30, 30),
        SubText = Color3.fromRGB(100, 100, 100),
        ToggleOn = Color3.fromRGB(59, 130, 246),
        ToggleOff = Color3.fromRGB(180, 180, 180),
        CornerRadius = UDim.new(0, 12),
        Shadow = Color3.fromRGB(200, 200, 200),
        ElementBackground = Color3.fromRGB(235, 235, 235),
        Hover = Color3.fromRGB(210, 210, 210),
        Border = Color3.fromRGB(200, 200, 200)
    },
    Midnight = {
        Background = Color3.fromRGB(10, 10, 15),
        Accent = Color3.fromRGB(99, 102, 241),
        Secondary = Color3.fromRGB(20, 20, 30),
        Text = Color3.fromRGB(226, 232, 240),
        SubText = Color3.fromRGB(148, 163, 184),
        ToggleOn = Color3.fromRGB(99, 102, 241),
        ToggleOff = Color3.fromRGB(30, 41, 59),
        CornerRadius = UDim.new(0, 8),
        Shadow = Color3.fromRGB(0, 0, 0),
        ElementBackground = Color3.fromRGB(15, 23, 42),
        Hover = Color3.fromRGB(30, 41, 59),
        Border = Color3.fromRGB(51, 65, 85)
    },
    Cyber = {
        Background = Color3.fromRGB(13, 13, 23),
        Accent = Color3.fromRGB(0, 255, 255),
        Secondary = Color3.fromRGB(26, 26, 46),
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(170, 170, 200),
        ToggleOn = Color3.fromRGB(0, 255, 255),
        ToggleOff = Color3.fromRGB(40, 40, 60),
        CornerRadius = UDim.new(0, 6),
        Shadow = Color3.fromRGB(0, 255, 255),
        ElementBackground = Color3.fromRGB(20, 20, 35),
        Hover = Color3.fromRGB(35, 35, 60),
        Border = Color3.fromRGB(0, 200, 200)
    }
}

local Theme = Themes.Dark

-- ============================================
-- ENHANCED NOTIFICATION SYSTEM
-- ============================================

local NotificationSystem = {}
NotificationSystem.__index = NotificationSystem

function NotificationSystem.Init()
    local self = setmetatable({}, NotificationSystem)
    
    self.Gui = Create("ScreenGui", {
        Name = GenerateRandomName(),
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 9999
    })
    
    self.Container = Create("Frame", {
        Parent = self.Gui,
        Size = UDim2.new(0, 360, 1, -40),
        Position = UDim2.new(1, -380, 0, 20),
        BackgroundTransparency = 1,
        ClipsDescendants = false
    })
    
    self.Layout = Create("UIListLayout", {
        Parent = self.Container,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10),
        VerticalAlignment = Enum.VerticalAlignment.Bottom,
        HorizontalAlignment = Enum.HorizontalAlignment.Right
    })
    
    self.ActiveNotifications = {}
    self.MaxNotifications = 5
    
    return self
end

function NotificationSystem:Notify(config)
    config = config or {}
    local title = config.Title or "Notification"
    local content = config.Content or ""
    local duration = config.Duration or 5
    local iconName = config.Icon or "bell"
    local notifType = config.Type or "Info"
    
    -- Type styling
    local typeStyles = {
        Info = {Color = Theme.Accent, Icon = "info"},
        Success = {Color = Color3.fromRGB(34, 197, 94), Icon = "check"},
        Warning = {Color = Color3.fromRGB(234, 179, 8), Icon = "target"},
        Error = {Color = Color3.fromRGB(239, 68, 68), Icon = "x"},
        Premium = {Color = Color3.fromRGB(168, 85, 247), Icon = "star"}
    }
    
    local style = typeStyles[notifType] or typeStyles.Info
    local iconImage = IconManager:GetIcon(config.Icon or style.Icon)
    
    -- Remove old notifications if exceeding max
    if #self.ActiveNotifications >= self.MaxNotifications then
        local oldest = table.remove(self.ActiveNotifications, 1)
        if oldest then oldest:Close() end
    end
    
    -- Create notification frame
    local notifFrame = Create("Frame", {
        Parent = self.Container,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        BackgroundTransparency = 1,
        LayoutOrder = tick()
    })
    
    local mainFrame = Create("Frame", {
        Parent = notifFrame,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Position = UDim2.new(1, 50, 0, 0),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0,
        ClipsDescendants = true
    })
    
    -- Rounded corners with custom clipping
    Create("UICorner", {CornerRadius = UDim.new(0, 14), Parent = mainFrame})
    
    -- Gradient border effect
    local stroke = Create("UIStroke", {
        Parent = mainFrame,
        Color = style.Color,
        Thickness = 1.5,
        Transparency = 0.4
    })
    
    -- Glow effect
    local glow = Create("ImageLabel", {
        Parent = mainFrame,
        Size = UDim2.new(1, 30, 1, 30),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5028857084",
        ImageColor3 = style.Color,
        ImageTransparency = 0.9,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
        ZIndex = -1
    })
    
    -- Icon container with gradient background
    local iconContainer = Create("Frame", {
        Parent = mainFrame,
        Size = UDim2.new(0, 44, 0, 44),
        Position = UDim2.new(0, 12, 0, 12),
        BackgroundColor3 = style.Color,
        BackgroundTransparency = 0.9
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = iconContainer})
    
    local icon = Create("ImageLabel", {
        Parent = iconContainer,
        Size = UDim2.new(0, 24, 0, 24),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = iconImage,
        ImageColor3 = style.Color
    })
    
    -- Title
    local titleLabel = Create("TextLabel", {
        Parent = mainFrame,
        Text = title,
        Font = Enum.Font.GothamBold,
        TextSize = 15,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 68, 0, 12),
        Size = UDim2.new(1, -90, 0, 20),
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    -- Content with text wrapping
    local contentLabel = Create("TextLabel", {
        Parent = mainFrame,
        Text = content,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 68, 0, 34),
        Size = UDim2.new(1, -80, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        TextYAlignment = Enum.TextYAlignment.Top
    })
    
    -- Close button
    local closeBtn = Create("ImageButton", {
        Parent = mainFrame,
        Size = UDim2.new(0, 18, 0, 18),
        Position = UDim2.new(1, -10, 0, 10),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundTransparency = 1,
        Image = IconManager:GetIcon("x"),
        ImageColor3 = Theme.SubText,
        ImageTransparency = 0.5
    })
    
    -- Progress bar with gradient
    local progressBarBg = Create("Frame", {
        Parent = mainFrame,
        Size = UDim2.new(1, 0, 0, 3),
        Position = UDim2.new(0, 0, 1, -3),
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0
    })
    
    local progressBar = Create("Frame", {
        Parent = progressBarBg,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = style.Color,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 1), Parent = progressBar})
    
    -- Calculate proper height
    task.wait()
    local contentHeight = math.min(contentLabel.TextBounds.Y, 150)
    local frameHeight = math.max(80, 50 + contentHeight + 20)
    
    notifFrame.Size = UDim2.new(1, 0, 0, frameHeight)
    
    -- Animation controller
    local notifObj = {
        Frame = notifFrame,
        Main = mainFrame,
        ProgressBar = progressBar,
        Closed = false
    }
    
    function notifObj:Close()
        if self.Closed then return end
        self.Closed = true
        
        -- Slide out animation
        Tween(mainFrame, {
            Position = UDim2.new(1, 50, 0, 0),
            BackgroundTransparency = 1
        }, 0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
        
        Tween(iconContainer, {BackgroundTransparency = 1}, 0.3)
        Tween(stroke, {Transparency = 1}, 0.3)
        
        task.wait(0.4)
        if notifFrame and notifFrame.Parent then
            notifFrame:Destroy()
        end
        
        -- Remove from active list
        for i, n in ipairs(self.ActiveNotifications) do
            if n == self then
                table.remove(self.ActiveNotifications, i)
                break
            end
        end
    end
    
    -- Entrance animation sequence
    Tween(mainFrame, {Position = UDim2.new(0, 0, 0, 0)}, 0.5, Enum.EasingStyle.Back)
    
    -- Progress bar animation
    Tween(progressBar, {Size = UDim2.new(0, 0, 1, 0)}, duration, Enum.EasingStyle.Linear)
    
    -- Interactions
    closeBtn.MouseButton1Click:Connect(function()
        notifObj:Close()
    end)
    
    mainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            -- Pause and resume logic could go here
        end
    end)
    
    -- Auto close
    task.delay(duration, function()
        notifObj:Close()
    end)
    
    table.insert(self.ActiveNotifications, notifObj)
    return notifObj
end

local Notifications = NotificationSystem.Init()

-- ============================================
-- ADVANCED DIALOG SYSTEM
-- ============================================

function AzureUI:CreateNumberDialog(config, callback)
    config = config or {}
    local title = config.Title or "Enter Value"
    local min = config.Min or 0
    local max = config.Max or 100
    local default = config.Default or min
    
    local dialogGui = Create("ScreenGui", {
        Name = GenerateRandomName(),
        Parent = CoreGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        DisplayOrder = 10000
    })
    
    local overlay = Create("Frame", {
        Parent = dialogGui,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.new(0, 0, 0),
        BackgroundTransparency = 1
    })
    
    local dialogFrame = Create("Frame", {
        Parent = overlay,
        Size = UDim2.new(0, 300, 0, 180),
        Position = UDim2.new(0.5, 0, 0.5, 20),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.05
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = dialogFrame})
    Create("UIStroke", {Parent = dialogFrame, Color = Theme.Accent, Thickness = 1.5, Transparency = 0.5})
    
    -- Title
    Create("TextLabel", {
        Parent = dialogFrame,
        Text = title,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        TextColor3 = Theme.Text,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 20, 0, 15),
        Size = UDim2.new(1, -40, 0, 25),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Range indicator
    Create("TextLabel", {
        Parent = dialogFrame,
        Text = "Range: " .. min .. " - " .. max,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        TextColor3 = Theme.SubText,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 20, 0, 40),
        Size = UDim2.new(1, -40, 0, 20),
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Input box
    local inputContainer = Create("Frame", {
        Parent = dialogFrame,
        Size = UDim2.new(0, 200, 0, 40),
        Position = UDim2.new(0.5, 0, 0.5, -10),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundColor3 = Theme.Secondary
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = inputContainer})
    
    local input = Create("TextBox", {
        Parent = inputContainer,
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Text = tostring(default),
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        TextColor3 = Theme.Text,
        ClearTextOnFocus = true
    })
    
    -- Buttons
    local cancelBtn = Create("TextButton", {
        Parent = dialogFrame,
        Size = UDim2.new(0, 120, 0, 36),
        Position = UDim2.new(0, 20, 1, -56),
        BackgroundColor3 = Theme.Secondary,
        Text = "Cancel",
        Font = Enum.Font.GothamBold,
        TextColor3 = Theme.Text,
        TextSize = 14,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = cancelBtn})
    
    local confirmBtn = Create("TextButton", {
        Parent = dialogFrame,
        Size = UDim2.new(0, 120, 0, 36),
        Position = UDim2.new(1, -140, 1, -56),
        BackgroundColor3 = Theme.Accent,
        Text = "Confirm",
        Font = Enum.Font.GothamBold,
        TextColor3 = Color3.new(1, 1, 1),
        TextSize = 14,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = confirmBtn})
    
    -- Animations
    Tween(overlay, {BackgroundTransparency = 0.7}, 0.2)
    Tween(dialogFrame, {Position = UDim2.new(0.5, 0, 0.5, 0)}, 0.3, Enum.EasingStyle.Back)
    
    local function close(result)
        Tween(overlay, {BackgroundTransparency = 1}, 0.2)
        Tween(dialogFrame, {Position = UDim2.new(0.5, 0, 0.5, 20), BackgroundTransparency = 1}, 0.2)
        task.wait(0.2)
        dialogGui:Destroy()
        if result and callback then
            callback(result)
        end
    end
    
    cancelBtn.MouseButton1Click:Connect(function() close(nil) end)
    
    confirmBtn.MouseButton1Click:Connect(function()
        local num = tonumber(input.Text)
        if num then
            num = math.clamp(num, min, max)
            close(num)
        else
            input.Text = tostring(default)
            -- Shake animation for invalid input
            Tween(inputContainer, {Position = UDim2.new(0.5, -5, 0.5, -10)}, 0.05)
            Tween(inputContainer, {Position = UDim2.new(0.5, 5, 0.5, -10)}, 0.05)
            Tween(inputContainer, {Position = UDim2.new(0.5, 0, 0.5, -10)}, 0.05)
        end
    end)
    
    input.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            confirmBtn.MouseButton1Click:Fire()
        end
    end)
end

-- ============================================
-- MAIN WINDOW CREATION
-- ============================================

function AzureUI:CreateWindow(config)
    config = config or {}
    local Window = {}
    setmetatable(Window, AzureUI)
    
    local titleText = config.Title or "AzureUI"
    local subTitle = config.SubTitle or ""
    local version = config.Version or "5.0"
    local windowSize = config.Size or UDim2.new(0, 900, 0, 550)
    local currentTheme = config.Theme or "Dark"
    Theme = Themes[currentTheme] or Themes.Dark
    
    -- State management
    Window.IsOpen = true
    Window.IsMinimized = false
    Window.IsCompact = false
    Window.Tabs = {}
    Window.ActiveTab = nil
    Window.Keybinds = {}
    Window.Elements = {}
    Window.Dragging = false
    Window.DragInput = nil
    Window.DragStart = nil
    Window.StartPos = nil
    
    -- GUI Setup
    local guiName = GenerateRandomName()
    Window.Gui = Create("ScreenGui", {
        Name = guiName,
        Parent = CoreGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })
    
    -- Main Container
    Window.Main = Create("Frame", {
        Name = GenerateRandomName(),
        Parent = Window.Gui,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.1,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -windowSize.X.Offset/2, 0.5, -windowSize.Y.Offset/2),
        Size = UDim2.new(0, 0, 0, 0),
        ClipsDescendants = true,
        Visible = false
    })
    
    local mainCorner = Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = Window.Main})
    
    -- Drop shadow
    local shadow = Create("ImageLabel", {
        Name = GenerateRandomName(),
        Parent = Window.Main,
        AnchorPoint = Vector2.new(0.5, 0.5),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        Size = UDim2.new(1, 40, 1, 40),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Theme.Shadow,
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(20, 20, 280, 280),
        ZIndex = -1
    })
    
    -- Glassmorphism overlay
    local glass = Create("ImageLabel", {
        Name = GenerateRandomName(),
        Parent = Window.Main,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5587865193",
        ImageColor3 = Color3.new(0.1, 0.1, 0.1),
        ImageTransparency = 0.85,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(10, 10, 118, 118),
        ZIndex = 0
    })
    
    -- Title Bar (Draggable Area)
    Window.TitleBar = Create("Frame", {
        Name = GenerateRandomName(),
        Parent = Window.Main,
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, 0, 0, 55)
    })
    
    -- Fix titlebar corners
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = Window.TitleBar})
    local titleBarFix = Create("Frame", {
        Parent = Window.TitleBar,
        Size = UDim2.new(1, 0, 0, 10),
        Position = UDim2.new(0, 0, 1, -10),
        BackgroundColor3 = Window.TitleBar.BackgroundColor3,
        BackgroundTransparency = Window.TitleBar.BackgroundTransparency,
        BorderSizePixel = 0
    })
    
    -- Drag handle indicator
    local dragHandle = Create("Frame", {
        Parent = Window.TitleBar,
        Size = UDim2.new(0, 40, 0, 4),
        Position = UDim2.new(0.5, 0, 0, 8),
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundColor3 = Theme.SubText,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = dragHandle})
    
    -- Title Section
    local titleSection = Create("Frame", {
        Parent = Window.TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 20, 0, 0),
        Size = UDim2.new(0.4, 0, 1, 0)
    })
    
    local titleList = Create("UIListLayout", {
        Parent = titleSection,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 12),
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    -- Icon
    if config.Icon then
        local titleIcon = Create("ImageLabel", {
            Parent = titleSection,
            Size = UDim2.new(0, 32, 0, 32),
            BackgroundTransparency = 1,
            Image = IconManager:GetIcon(config.Icon),
            ImageColor3 = Theme.Accent,
            LayoutOrder = 1
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = titleIcon})
    end
    
    -- Title text container
    local textContainer = Create("Frame", {
        Parent = titleSection,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 1, 0),
        AutomaticSize = Enum.AutomaticSize.X,
        LayoutOrder = 2
    })
    
    local titleLabel = Create("TextLabel", {
        Parent = textContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 0, 25),
        AutomaticSize = Enum.AutomaticSize.X,
        Position = UDim2.new(0, 0, 0, 8),
        Font = Enum.Font.GothamBold,
        Text = titleText,
        TextColor3 = Theme.Text,
        TextSize = 20,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    if subTitle ~= "" then
        Create("TextLabel", {
            Parent = textContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(0, 0, 0, 16),
            AutomaticSize = Enum.AutomaticSize.X,
            Position = UDim2.new(0, 0, 0, 30),
            Font = Enum.Font.Gotham,
            Text = subTitle,
            TextColor3 = Theme.SubText,
            TextSize = 12,
            TextXAlignment = Enum.TextXAlignment.Left
        })
    end
    
    -- Version badge
    local versionBadge = Create("Frame", {
        Parent = Window.TitleBar,
        Size = UDim2.new(0, 0, 0, 22),
        AutomaticSize = Enum.AutomaticSize.X,
        Position = UDim2.new(1, -150, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundColor3 = Theme.Accent,
        BackgroundTransparency = 0.9
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 11), Parent = versionBadge})
    Create("UIPadding", {Parent = versionBadge, PaddingLeft = UDim.new(0, 10), PaddingRight = UDim.new(0, 10)})
    
    Create("TextLabel", {
        Parent = versionBadge,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 1, 0),
        AutomaticSize = Enum.AutomaticSize.X,
        Font = Enum.Font.GothamBold,
        Text = "v" .. version,
        TextColor3 = Theme.Accent,
        TextSize = 12
    })
    
    -- Control Buttons Container
    local controlsContainer = Create("Frame", {
        Parent = Window.TitleBar,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 130, 0, 30),
        Position = UDim2.new(1, -15, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5)
    })
    
    local controlsList = Create("UIListLayout", {
        Parent = controlsContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10),
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    -- Advance/Minimize Button (Yellow)
    Window.AdvanceBtn = Create("ImageButton", {
        Parent = controlsContainer,
        LayoutOrder = 1,
        Size = UDim2.new(0, 16, 0, 16),
        BackgroundColor3 = Color3.fromRGB(255, 190, 0),
        Image = IconManager:GetIcon("minus"),
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.4,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = Window.AdvanceBtn})
    
    -- Close Button (Red)
    Window.CloseBtn = Create("ImageButton", {
        Parent = controlsContainer,
        LayoutOrder = 2,
        Size = UDim2.new(0, 16, 0, 16),
        BackgroundColor3 = Color3.fromRGB(255, 70, 70),
        Image = IconManager:GetIcon("x"),
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.4,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = Window.CloseBtn})
    
    -- Search Toggle
    local searchBtn = Create("ImageButton", {
        Parent = controlsContainer,
        LayoutOrder = 3,
        Size = UDim2.new(0, 28, 0, 28),
        BackgroundTransparency = 1,
        Image = IconManager:GetIcon("search"),
        ImageColor3 = Theme.SubText
    })
    
    -- Search Bar (Hidden by default)
    local searchBar = Create("Frame", {
        Parent = Window.Main,
        Size = UDim2.new(0, 250, 0, 40),
        Position = UDim2.new(0, 180, 0, 65),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.3,
        Visible = false,
        ZIndex = 10
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = searchBar})
    
    local searchInput = Create("TextBox", {
        Parent = searchBar,
        Size = UDim2.new(1, -50, 1, 0),
        Position = UDim2.new(0, 15, 0, 0),
        BackgroundTransparency = 1,
        Text = "",
        PlaceholderText = "Search features...",
        Font = Enum.Font.Gotham,
        TextSize = 14,
        TextColor3 = Theme.Text,
        ClearTextOnFocus = false
    })
    
    local searchClose = Create("ImageButton", {
        Parent = searchBar,
        Size = UDim2.new(0, 20, 0, 20),
        Position = UDim2.new(1, -30, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundTransparency = 1,
        Image = IconManager:GetIcon("x"),
        ImageColor3 = Theme.SubText
    })
    
    -- Sidebar (Collapsible)
    Window.TabContainer = Create("Frame", {
        Name = GenerateRandomName(),
        Parent = Window.Main,
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.4,
        Position = UDim2.new(0, 15, 0, 65),
        Size = UDim2.new(0, 170, 1, -80),
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = Window.TabContainer})
    
    Window.TabListLayout = Create("UIListLayout", {
        Parent = Window.TabContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8),
        VerticalAlignment = Enum.VerticalAlignment.Top
    })
    
    Create("UIPadding", {
        Parent = Window.TabContainer,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    
    -- Content Area
    Window.ContentFrame = Create("ScrollingFrame", {
        Name = GenerateRandomName(),
        Parent = Window.Main,
        BackgroundColor3 = Theme.ElementBackground,
        BackgroundTransparency = 0.6,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 195, 0, 65),
        Size = UDim2.new(1, -210, 1, -80),
        CanvasSize = UDim2.new(0, 0, 0, 0),
        ScrollBarThickness = 4,
        AutomaticCanvasSize = Enum.AutomaticSize.Y,
        ScrollBarImageColor3 = Theme.Accent,
        ScrollBarImageTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = Window.ContentFrame})
    Create("UIPadding", {
        Parent = Window.ContentFrame,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15),
        PaddingTop = UDim.new(0, 15),
        PaddingBottom = UDim.new(0, 15)
    })
    
    Window.ContentListLayout = Create("UIListLayout", {
        Parent = Window.ContentFrame,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 12)
    })
    
    -- Compact Mode Bar (Bottom position - Sirius style)
    Window.CompactBar = Create("Frame", {
        Parent = Window.Gui,
        Size = UDim2.new(0, 0, 0, 60),
        Position = UDim2.new(0.5, 0, 1, -80),
        AnchorPoint = Vector2.new(0.5, 0),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.1,
        Visible = false,
        BorderSizePixel = 0,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = Window.CompactBar})
    Create("UIStroke", {Parent = Window.CompactBar, Color = Theme.Accent, Thickness = 1.5, Transparency = 0.5})
    
    -- Compact bar glow
    local compactGlow = Create("ImageLabel", {
        Parent = Window.CompactBar,
        Size = UDim2.new(1, 20, 1, 20),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5028857084",
        ImageColor3 = Theme.Accent,
        ImageTransparency = 0.9,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
        ZIndex = -1
    })
    
    Window.CompactList = Create("UIListLayout", {
        Parent = Window.CompactBar,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10),
        HorizontalAlignment = Enum.HorizontalAlignment.Center,
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    Create("UIPadding", {
        Parent = Window.CompactBar,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15)
    })
    
    -- Compact mode restore button
    Window.RestoreBtn = Create("ImageButton", {
        Parent = Window.CompactBar,
        Size = UDim2.new(0, 40, 0, 40),
        BackgroundColor3 = Theme.Accent,
        Image = IconManager:GetIcon("maximize"),
        ImageColor3 = Color3.new(1, 1, 1),
        AutoButtonColor = false,
        LayoutOrder = -1
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = Window.RestoreBtn})
    
    -- ============================================
    -- FUNCTIONALITY METHODS
    -- ============================================
    
    function Window:Notify(config)
        return Notifications:Notify(config)
    end
    
    function Window:Open()
        Window.IsOpen = true
        Window.Main.Visible = true
        Window.Gui.Enabled = true
        
        if Window.IsCompact then
            Window:RestoreFromCompact()
        end
        
        Tween(Window.Main, {Size = windowSize}, 0.4, Enum.EasingStyle.Back)
        Tween(Window.Main, {BackgroundTransparency = 0.1}, 0.3)
    end
    
    function Window:Close()
        Window.IsOpen = false
        Tween(Window.Main, {Size = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
        Tween(Window.Main, {BackgroundTransparency = 1}, 0.3)
        task.wait(0.3)
        Window.Main.Visible = false
    end
    
    function Window:Toggle()
        if Window.IsOpen then 
            Window:Close() 
        else 
            Window:Open() 
        end
    end
    
    -- Compact Mode (Sirius Style)
    function Window:EnterCompactMode()
        Window.IsCompact = true
        
        -- Animate main window out to bottom
        Tween(Window.Main, {Position = UDim2.new(0.5, 0, 1, 50)}, 0.4, Enum.EasingStyle.Quint)
        Tween(Window.Main, {BackgroundTransparency = 1}, 0.3)
        
        task.wait(0.2)
        Window.Main.Visible = false
        
        -- Show compact bar
        Window.CompactBar.Visible = true
        Window.CompactBar.Size = UDim2.new(0, 0, 0, 60)
        
        -- Animate compact bar in
        local targetWidth = math.min(60 + (#Window.Tabs * 50), 400)
        Tween(Window.CompactBar, {Size = UDim2.new(0, targetWidth, 0, 60)}, 0.4, Enum.EasingStyle.Back)
        
        Window:PopulateCompactBar()
        
        Window:Notify({
            Title = "Compact Mode",
            Content = "UI minimized to bottom bar. Click any tab to view content.",
            Type = "Info",
            Duration = 3
        })
    end
    
    function Window:RestoreFromCompact()
        Window.IsCompact = false
        
        -- Hide compact bar
        Tween(Window.CompactBar, {Size = UDim2.new(0, 0, 0, 60)}, 0.3, Enum.EasingStyle.Quint)
        
        task.wait(0.2)
        Window.CompactBar.Visible = false
        
        -- Restore main window
        Window.Main.Visible = true
        Tween(Window.Main, {Position = UDim2.new(0.5, -windowSize.X.Offset/2, 0.5, -windowSize.Y.Offset/2)}, 0.4, Enum.EasingStyle.Back)
        Tween(Window.Main, {BackgroundTransparency = 0.1}, 0.3)
    end
    
    function Window:PopulateCompactBar()
        -- Clear existing (except restore button)
        for _, child in pairs(Window.CompactBar:GetChildren()) do
            if child:IsA("TextButton") or (child:IsA("ImageButton") and child ~= Window.RestoreBtn) then
                child:Destroy()
            end
        end
        
        -- Add tab buttons to compact bar
        for _, tab in ipairs(Window.Tabs) do
            local btn = Create("ImageButton", {
                Parent = Window.CompactBar,
                Size = UDim2.new(0, 40, 0, 40),
                BackgroundColor3 = tab == Window.ActiveTab and Theme.Accent or Theme.Secondary,
                Image = IconManager:GetIcon(tab.Icon or "menu"),
                ImageColor3 = tab == Window.ActiveTab and Color3.new(1, 1, 1) or Theme.SubText,
                AutoButtonColor = false,
                LayoutOrder = tab.LayoutOrder or 1
            })
            Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = btn})
            
            btn.MouseButton1Click:Connect(function()
                Window:ShowCompactTab(tab)
            end)
        end
    end
    
    function Window:ShowCompactTab(tab)
        -- Create floating panel for tab content
        if Window.CompactPanel and Window.CompactPanel.Parent then
            Window.CompactPanel:Destroy()
        end
        
        local panel = Create("Frame", {
            Parent = Window.Gui,
            Size = UDim2.new(0, 350, 0, 400),
            Position = UDim2.new(0.5, 0, 1, -500),
            AnchorPoint = Vector2.new(0.5, 0),
            BackgroundColor3 = Theme.Background,
            BackgroundTransparency = 0.05,
            BorderSizePixel = 0
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 16), Parent = panel})
        Create("UIStroke", {Parent = panel, Color = Theme.Accent, Thickness = 1.5, Transparency = 0.4})
        
        -- Title
        local titleBar = Create("Frame", {
            Parent = panel,
            Size = UDim2.new(1, 0, 0, 45),
            BackgroundColor3 = Theme.Secondary,
            BackgroundTransparency = 0.5
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = titleBar})
        
        Create("TextLabel", {
            Parent = titleBar,
            Size = UDim2.new(1, -60, 1, 0),
            Position = UDim2.new(0, 15, 0, 0),
            BackgroundTransparency = 1,
            Text = tab.Name,
            Font = Enum.Font.GothamBold,
            TextColor3 = Theme.Text,
            TextSize = 16,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local closePanel = Create("ImageButton", {
            Parent = titleBar,
            Size = UDim2.new(0, 30, 0, 30),
            Position = UDim2.new(1, -10, 0.5, 0),
            AnchorPoint = Vector2.new(1, 0.5),
            BackgroundTransparency = 1,
            Image = IconManager:GetIcon("x"),
            ImageColor3 = Theme.SubText
        })
        
        -- Content container
        local content = Create("ScrollingFrame", {
            Parent = panel,
            Size = UDim2.new(1, -20, 1, -65),
            Position = UDim2.new(0, 10, 0, 55),
            BackgroundTransparency = 1,
            ScrollBarThickness = 4,
            CanvasSize = tab.Content.CanvasSize,
            ScrollBarImageColor3 = Theme.Accent
        })
        
        -- Clone tab content
        for _, element in pairs(tab.Content:GetChildren()) do
            if element:IsA("GuiObject") then
                local clone = element:Clone()
                clone.Parent = content
            end
        end
        
        Create("UIListLayout", {
            Parent = content,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 10)
        })
        
        -- Animate in
        panel.Size = UDim2.new(0, 0, 0, 0)
        Tween(panel, {Size = UDim2.new(0, 350, 0, 400)}, 0.3, Enum.EasingStyle.Back)
        
        closePanel.MouseButton1Click:Connect(function()
            Tween(panel, {Size = UDim2.new(0, 0, 0, 0)}, 0.2)
            task.wait(0.2)
            panel:Destroy()
        end)
        
        Window.CompactPanel = panel
    end
    
    -- ============================================
    -- DRAGGING SYSTEM (Fixed)
    -- ============================================
    
    local function updateDrag(input)
        local delta = input.Position - Window.DragStart
        local newPosition = UDim2.new(
            Window.StartPos.X.Scale, 
            Window.StartPos.X.Offset + delta.X, 
            Window.StartPos.Y.Scale, 
            Window.StartPos.Y.Offset + delta.Y
        )
        Window.Main.Position = newPosition
    end
    
    Window.TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Window.Dragging = true
            Window.DragStart = input.Position
            Window.StartPos = Window.Main.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    Window.Dragging = false
                end
            end)
        end
    end)
    
    Window.TitleBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement and Window.Dragging then
            updateDrag(input)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if Window.Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateDrag(input)
        end
    end)
    
    -- ============================================
    -- EVENT CONNECTIONS
    -- ============================================
    
    -- Advance/Minimize Button
    Window.AdvanceBtn.MouseButton1Click:Connect(function()
        Ripple(Window.AdvanceBtn)
        if Window.IsCompact then
            Window:RestoreFromCompact()
        else
            Window:EnterCompactMode()
        end
    end)
    
    -- Close Button
    Window.CloseBtn.MouseButton1Click:Connect(function()
        Ripple(Window.CloseBtn, Color3.fromRGB(255, 100, 100))
        Window:Close()
    end)
    
    -- Search Toggle
    local searchOpen = false
    searchBtn.MouseButton1Click:Connect(function()
        searchOpen = not searchOpen
        searchBar.Visible = searchOpen
        Window.ContentFrame.Visible = not searchOpen
        
        if searchOpen then
            Tween(searchBar, {BackgroundTransparency = 0.3}, 0.2)
            searchInput:CaptureFocus()
        end
    end)
    
    searchClose.MouseButton1Click:Connect(function()
        searchOpen = false
        searchBar.Visible = false
        Window.ContentFrame.Visible = true
        searchInput.Text = ""
    end)
    
    -- Search functionality
    searchInput:GetPropertyChangedSignal("Text"):Connect(function()
        local query = searchInput.Text:lower()
        for _, tab in pairs(Window.Tabs) do
            for _, element in pairs(tab.Elements or {}) do
                if element.SetVisible then
                    element:SetVisible(query == "" or (element.Name and element.Name:lower():find(query)))
                end
            end
        end
    end)
    
    -- Toggle Key
    Window.ToggleKey = config.ToggleKey or Enum.KeyCode.K
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Window.ToggleKey then
            Window:Toggle()
        end
    end)
    
    -- Initialize
    task.spawn(function()
        task.wait(0.1)
        Window:Open()
    end)
    
    return Window
end

-- ============================================
-- TAB CREATION (With Icon Support)
-- ============================================

function AzureUI:CreateTab(config)
    local Window = self
    config = config or {}
    local name = config.Name or "Tab"
    local icon = config.Icon or "menu"
    local Tab = {}
    setmetatable(Tab, AzureUI)
    
    Tab.Name = name
    Tab.Icon = icon
    Tab.LayoutOrder = #Window.Tabs + 1
    Tab.Elements = {}
    Tab.Pinned = false
    
    -- Tab Button
    local tabBtn = Create("TextButton", {
        Name = GenerateRandomName(),
        Parent = Window.TabContainer,
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.5,
        Size = UDim2.new(1, 0, 0, 42),
        Text = "",
        AutoButtonColor = false,
        LayoutOrder = Tab.LayoutOrder
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = tabBtn})
    
    -- Layout container
    local layoutContainer = Create("Frame", {
        Parent = tabBtn,
        Size = UDim2.new(1, -10, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1
    })
    
    local listLayout = Create("UIListLayout", {
        Parent = layoutContainer,
        FillDirection = Enum.FillDirection.Horizontal,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 12),
        VerticalAlignment = Enum.VerticalAlignment.Center
    })
    
    -- Icon using IconManager
    local tabIcon = IconManager:CreateIcon({
        Icon = icon,
        Size = UDim2.new(0, 22, 0, 22),
        Color = Theme.SubText
    })
    tabIcon.Parent = layoutContainer
    tabIcon.LayoutOrder = 1
    
    -- Text
    local tabText = Create("TextLabel", {
        Parent = layoutContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(0, 0, 1, 0),
        AutomaticSize = Enum.AutomaticSize.X,
        Font = Enum.Font.GothamSemibold,
        Text = name,
        TextColor3 = Theme.SubText,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left,
        LayoutOrder = 2
    })
    
    -- Pin button (visible on hover)
    local pinBtn = Create("ImageButton", {
        Parent = tabBtn,
        Size = UDim2.new(0, 18, 0, 18),
        Position = UDim2.new(1, -25, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundTransparency = 1,
        Image = IconManager:GetIcon("pin"),
        ImageColor3 = Theme.SubText,
        ImageTransparency = 1,
        AutoButtonColor = false
    })
    
    -- Content Container
    Tab.Content = Create("Frame", {
        Parent = Window.ContentFrame,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.Y,
        Visible = false,
        LayoutOrder = 1
    })
    
    local contentLayout = Create("UIListLayout", {
        Parent = Tab.Content,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 10)
    })
    
    -- Hover effects
    tabBtn.MouseEnter:Connect(function()
        Tween(tabBtn, {BackgroundTransparency = 0.2}, 0.2)
        Tween(pinBtn, {ImageTransparency = 0.4}, 0.2)
    end)
    
    tabBtn.MouseLeave:Connect(function()
        if Window.ActiveTab ~= Tab then
            Tween(tabBtn, {BackgroundTransparency = 0.5}, 0.2)
        end
        Tween(pinBtn, {ImageTransparency = 1}, 0.2)
    end)
    
    -- Pin functionality
    pinBtn.MouseButton1Click:Connect(function()
        Tab.Pinned = not Tab.Pinned
        pinBtn.ImageColor3 = Tab.Pinned and Theme.Accent or Theme.SubText
        if Tab.Pinned then
            pinBtn.ImageTransparency = 0
            -- Move to top of list logic here if needed
        end
    end)
    
    -- Tab selection
    tabBtn.MouseButton1Click:Connect(function()
        if Window.ActiveTab == Tab then return end
        
        -- Deselect current
        if Window.ActiveTab then
            Tween(Window.ActiveTab.Button, {BackgroundColor3 = Theme.Secondary, BackgroundTransparency = 0.5}, 0.3)
            Tween(Window.ActiveTab.IconLabel, {ImageColor3 = Theme.SubText}, 0.3)
            Tween(Window.ActiveTab.TextLabel, {TextColor3 = Theme.SubText}, 0.3)
            Window.ActiveTab.Content.Visible = false
        end
        
        -- Select new
        Window.ActiveTab = Tab
        Tween(tabBtn, {BackgroundColor3 = Theme.Accent, BackgroundTransparency = 0.1}, 0.3)
        Tween(tabIcon, {ImageColor3 = Color3.new(1, 1, 1)}, 0.3)
        Tween(tabText, {TextColor3 = Color3.new(1, 1, 1)}, 0.3)
        
        Tab.Content.Visible = true
        
        -- Animation for content
        Tab.Content.Position = UDim2.new(0, 20, 0, 0)
        Tween(Tab.Content, {Position = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Quart)
    end)
    
    Tab.Button = tabBtn
    Tab.IconLabel = tabIcon
    Tab.TextLabel = tabText
    Tab.Window = Window
    
    -- Set as active if first tab
    if #Window.Tabs == 0 then
        Window.ActiveTab = Tab
        tabBtn.BackgroundColor3 = Theme.Accent
        tabBtn.BackgroundTransparency = 0.1
        tabIcon.ImageColor3 = Color3.new(1, 1, 1)
        tabText.TextColor3 = Color3.new(1, 1, 1)
        Tab.Content.Visible = true
    end
    
    table.insert(Window.Tabs, Tab)
    
    -- Update compact bar if in compact mode
    if Window.IsCompact then
        Window:PopulateCompactBar()
    end
    
    return Tab
end

-- ============================================
-- FIXED DROPDOWN (Pushes Content)
-- ============================================

function AzureUI:CreateDropdown(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Dropdown"
    local values = config.Values or {}
    local default = config.Default
    local multi = config.Multi or false
    local callback = config.Callback or function() end
    
    -- Main container that expands
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 42), -- Base height
        LayoutOrder = #parent:GetChildren(),
        ClipsDescendants = false
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 0, 42),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.6,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 12),
        PaddingRight = UDim.new(0, 12)
    })
    
    -- Label
    Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.35, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Dropdown button
    local dropdownBtn = Create("TextButton", {
        Parent = container,
        Size = UDim2.new(0.65, -10, 0, 32),
        Position = UDim2.new(0.35, 10, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundColor3 = Theme.Background,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = dropdownBtn})
    
    local selectedText = Create("TextLabel", {
        Parent = dropdownBtn,
        Size = UDim2.new(1, -35, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.Gotham,
        Text = multi and (default and table.concat(default, ", ") or "Select...") or (default or "Select..."),
        TextColor3 = Theme.SubText,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    local arrow = Create("ImageLabel", {
        Parent = dropdownBtn,
        Size = UDim2.new(0, 18, 0, 18),
        Position = UDim2.new(1, -24, 0.5, 0),
        AnchorPoint = Vector2.new(0, 0.5),
        BackgroundTransparency = 1,
        Image = IconManager:GetIcon("chevron-down"),
        ImageColor3 = Theme.SubText
    })
    
    -- Options container (Expands parent)
    local optionsContainer = Create("Frame", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 0),
        Position = UDim2.new(0, 0, 0, 45),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.5,
        ClipsDescendants = true,
        Visible = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = optionsContainer})
    
    local optionsList = Create("UIListLayout", {
        Parent = optionsContainer,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 4)
    })
    
    Create("UIPadding", {
        Parent = optionsContainer,
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
        PaddingTop = UDim.new(0, 8),
        PaddingBottom = UDim.new(0, 8)
    })
    
    local isOpen = false
    local selected = multi and (default and {table.unpack(default)} or {}) or default
    
    local function updateSize()
        local contentHeight = #values * 36 + (#values - 1) * 4 + 16 -- items + padding
        optionsContainer.Size = UDim2.new(1, 0, 0, contentHeight)
    end
    
    local function openDropdown()
        isOpen = true
        optionsContainer.Visible = true
        
        -- Calculate and set frame size to accommodate dropdown
        local fullHeight = 42 + 5 + optionsContainer.Size.Y.Offset
        Tween(frame, {Size = UDim2.new(1, 0, 0, fullHeight)}, 0.3, Enum.EasingStyle.Quart)
        Tween(container, {Size = UDim2.new(1, 0, 0, fullHeight)}, 0.3, Enum.EasingStyle.Quart)
        Tween(optionsContainer, {BackgroundTransparency = 0}, 0.2)
        Tween(arrow, {Rotation = 180}, 0.3, Enum.EasingStyle.Back)
        
        -- Update canvas size of parent scrolling frame if exists
        if parent:IsA("ScrollingFrame") then
            local currentCanvas = parent.CanvasSize.Y.Offset
            Tween(parent, {CanvasSize = UDim2.new(0, 0, 0, currentCanvas + fullHeight - 42)}, 0.3)
        end
    end
    
    local function closeDropdown()
        isOpen = false
        Tween(frame, {Size = UDim2.new(1, 0, 0, 42)}, 0.3, Enum.EasingStyle.Quart)
        Tween(container, {Size = UDim2.new(1, 0, 0, 42)}, 0.3, Enum.EasingStyle.Quart)
        Tween(optionsContainer, {BackgroundTransparency = 1}, 0.2)
        Tween(arrow, {Rotation = 0}, 0.3, Enum.EasingStyle.Back)
        
        task.delay(0.3, function()
            if not isOpen then
                optionsContainer.Visible = false
            end
        end)
    end
    
    -- Create options
    for i, value in ipairs(values) do
        local btn = Create("TextButton", {
            Parent = optionsContainer,
            Size = UDim2.new(1, 0, 0, 36),
            BackgroundColor3 = Theme.Secondary,
            BackgroundTransparency = 1,
            Text = value,
            Font = Enum.Font.Gotham,
            TextColor3 = Theme.Text,
            TextSize = 13,
            LayoutOrder = i,
            AutoButtonColor = false
        })
        Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = btn})
        
        -- Checkmark for selected items
        local checkmark = Create("ImageLabel", {
            Parent = btn,
            Size = UDim2.new(0, 16, 0, 16),
            Position = UDim2.new(1, -20, 0.5, 0),
            AnchorPoint = Vector2.new(0, 0.5),
            BackgroundTransparency = 1,
            Image = IconManager:GetIcon("check"),
            ImageColor3 = Theme.Accent,
            ImageTransparency = 1
        })
        
        btn.MouseEnter:Connect(function()
            Tween(btn, {BackgroundTransparency = 0.5}, 0.2)
        end)
        btn.MouseLeave:Connect(function()
            Tween(btn, {BackgroundTransparency = 1}, 0.2)
        end)
        
        btn.MouseButton1Click:Connect(function()
            if multi then
                local idx = table.find(selected, value)
                if idx then
                    table.remove(selected, idx)
                    Tween(checkmark, {ImageTransparency = 1}, 0.2)
                else
                    table.insert(selected, value)
                    Tween(checkmark, {ImageTransparency = 0}, 0.2)
                end
                selectedText.Text = #selected > 0 and table.concat(selected, ", ") or "Select..."
            else
                selected = value
                selectedText.Text = value
                for _, child in pairs(optionsContainer:GetChildren()) do
                    if child:IsA("TextButton") then
                        Tween(child:FindFirstChildOfClass("ImageLabel"), {ImageTransparency = 1}, 0.2)
                    end
                end
                Tween(checkmark, {ImageTransparency = 0}, 0.2)
                closeDropdown()
            end
            callback(selected)
        end)
    end
    
    updateSize()
    
    dropdownBtn.MouseButton1Click:Connect(function()
        if isOpen then closeDropdown() else openDropdown() end
    end)
    
    local dropdownObj = {
        Name = name,
        Type = "Dropdown",
        SetVisible = function(self, visible) frame.Visible = visible end,
        Save = function(self) return selected end,
        Load = function(self, data)
            selected = data
            if multi then
                selectedText.Text = #selected > 0 and table.concat(selected, ", ") or "Select..."
            else
                selectedText.Text = selected or "Select..."
            end
            callback(selected)
        end,
        Set = function(self, value)
            selected = value
            if multi then
                selectedText.Text = #selected > 0 and table.concat(selected, ", ") or "Select..."
            else
                selectedText.Text = selected or "Select..."
            end
            callback(selected)
        end
    }
    
    table.insert(self.Elements, dropdownObj)
    return dropdownObj
end

-- ============================================
-- ENHANCED SLIDER WITH NUMBER INPUT
-- ============================================

function AzureUI:CreateSlider(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Slider"
    local min = config.Min or 0
    local max = config.Max or 100
    local default = math.clamp(config.Default or min, min, max)
    local callback = config.Callback or function() end
    local decimals = config.Decimals or 0
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 55),
        LayoutOrder = #parent:GetChildren()
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.6
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    
    -- Top row with title and value
    local topRow = Create("Frame", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 20),
        BackgroundTransparency = 1
    })
    
    Create("TextLabel", {
        Parent = topRow,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Editable value button
    local valueBtn = Create("TextButton", {
        Parent = topRow,
        Size = UDim2.new(0, 60, 0, 24),
        Position = UDim2.new(1, 0, 0, 0),
        AnchorPoint = Vector2.new(1, 0),
        BackgroundColor3 = Theme.Background,
        Text = tostring(default),
        Font = Enum.Font.GothamBold,
        TextColor3 = Theme.Accent,
        TextSize = 13,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = valueBtn})
    Create("UIStroke", {Parent = valueBtn, Color = Theme.Accent, Thickness = 1, Transparency = 0.6})
    
    -- Slider track
    local track = Create("Frame", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 6),
        Position = UDim2.new(0, 0, 0, 36),
        BackgroundColor3 = Color3.fromRGB(50, 50, 50),
        BackgroundTransparency = 0.5,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = track})
    
    -- Fill
    local fill = Create("Frame", {
        Parent = track,
        BackgroundColor3 = Theme.Accent,
        Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
    
    -- Knob
    local knob = Create("TextButton", {
        Parent = track,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = UDim2.new((default - min) / (max - min), -9, 0.5, -9),
        Size = UDim2.new(0, 18, 0, 18),
        Text = "",
        AutoButtonColor = false,
        ZIndex = 2
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
    Create("UIStroke", {Parent = knob, Color = Theme.Accent, Thickness = 3})
    
    -- Glow effect for knob
    local knobGlow = Create("ImageLabel", {
        Parent = knob,
        Size = UDim2.new(1.5, 0, 1.5, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5028857084",
        ImageColor3 = Theme.Accent,
        ImageTransparency = 0.8,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(24, 24, 276, 276),
        ZIndex = -1
    })
    
    local value = default
    local dragging = false
    
    local function updateSlider(input, snap)
        local trackPos = track.AbsolutePosition.X
        local trackSize = track.AbsoluteSize.X
        local pos = math.clamp((input.Position.X - trackPos) / trackSize, 0, 1)
        
        if snap and config.Snap then
            local increment = config.Snap
            local range = max - min
            local steps = range / increment
            pos = math.round(pos * steps) / steps
        end
        
        value = min + (pos * (max - min))
        if decimals == 0 then
            value = math.floor(value)
        else
            value = math.floor(value * (10 ^ decimals)) / (10 ^ decimals)
        end
        
        -- Animate fill and knob
        Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.1)
        Tween(knob, {Position = UDim2.new(pos, -9, 0.5, -9)}, 0.1)
        valueBtn.Text = tostring(value)
        
        callback(value)
    end
    
    -- Input handling
    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            Tween(knobGlow, {ImageTransparency = 0.5}, 0.2)
        end
    end)
    
    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            updateSlider(input, true)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateSlider(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            Tween(knobGlow, {ImageTransparency = 0.8}, 0.2)
        end
    end)
    
    -- Number input dialog
    valueBtn.MouseButton1Click:Connect(function()
        AzureUI:CreateNumberDialog({
            Title = "Set " .. name,
            Min = min,
            Max = max,
            Default = value
        }, function(newValue)
            if newValue then
                value = newValue
                local pos = (value - min) / (max - min)
                Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
                Tween(knob, {Position = UDim2.new(pos, -9, 0.5, -9)}, 0.2)
                valueBtn.Text = tostring(value)
                callback(value)
            end
        end)
    end)
    
    local sliderObj = {
        Name = name,
        Type = "Slider",
        SetVisible = function(self, visible) frame.Visible = visible end,
        Save = function(self) return value end,
        Load = function(self, data)
            value = math.clamp(data, min, max)
            local pos = (value - min) / (max - min)
            Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
            Tween(knob, {Position = UDim2.new(pos, -9, 0.5, -9)}, 0.2)
            valueBtn.Text = tostring(value)
            callback(value)
        end,
        Set = function(self, val)
            value = math.clamp(val, min, max)
            local pos = (value - min) / (max - min)
            Tween(fill, {Size = UDim2.new(pos, 0, 1, 0)}, 0.2)
            Tween(knob, {Position = UDim2.new(pos, -9, 0.5, -9)}, 0.2)
            valueBtn.Text = tostring(value)
            callback(value)
        end
    }
    
    table.insert(self.Elements, sliderObj)
    return sliderObj
end

-- ============================================
-- OTHER ELEMENTS (Toggle, Button, Input, etc.)
-- ============================================

function AzureUI:CreateToggle(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Toggle"
    local default = config.Default or false
    local callback = config.Callback or function() end
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 45),
        LayoutOrder = #parent:GetChildren()
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.6
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15)
    })
    
    Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.7, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Modern switch design
    local switch = Create("TextButton", {
        Parent = container,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, 0, 0.5, 0),
        BackgroundColor3 = default and Theme.ToggleOn or Theme.ToggleOff,
        Size = UDim2.new(0, 50, 0, 26),
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = switch})
    
    local indicator = Create("Frame", {
        Parent = switch,
        BackgroundColor3 = Color3.new(1, 1, 1),
        Position = default and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 4, 0.5, -10),
        Size = UDim2.new(0, 20, 0, 20),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = indicator})
    
    -- Shadow for indicator
    Create("ImageLabel", {
        Parent = indicator,
        Size = UDim2.new(1, 4, 1, 4),
        Position = UDim2.new(0.5, 0, 0.5, 0),
        AnchorPoint = Vector2.new(0.5, 0.5),
        BackgroundTransparency = 1,
        Image = "rbxassetid://5554236805",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.7,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(20, 20, 280, 280),
        ZIndex = -1
    })
    
    local enabled = default
    
    local toggleObj = {
        Name = name,
        Type = "Toggle",
        SetVisible = function(self, visible) frame.Visible = visible end,
        Save = function(self) return enabled end,
        Load = function(self, data) 
            enabled = data
            switch.BackgroundColor3 = enabled and Theme.ToggleOn or Theme.ToggleOff
            indicator.Position = enabled and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 4, 0.5, -10)
            callback(enabled)
        end,
        Set = function(self, value)
            enabled = value
            Tween(switch, {BackgroundColor3 = enabled and Theme.ToggleOn or Theme.ToggleOff}, 0.3)
            Tween(indicator, {Position = enabled and UDim2.new(1, -22, 0.5, -10) or UDim2.new(0, 4, 0.5, -10)}, 0.3, Enum.EasingStyle.Back)
            callback(enabled)
        end
    }
    
    switch.MouseButton1Click:Connect(function()
        toggleObj:Set(not enabled)
    end)
    
    table.insert(self.Elements, toggleObj)
    return toggleObj
end

function AzureUI:CreateButton(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Button"
    local variant = config.Variant or "Primary"
    
    local btn = Create("TextButton", {
        Parent = parent,
        BackgroundColor3 = variant == "Secondary" and Theme.Secondary or Theme.Accent,
        Size = UDim2.new(1, 0, 0, 42),
        Font = Enum.Font.GothamBold,
        Text = name,
        TextColor3 = variant == "Secondary" and Theme.Text or Color3.new(1, 1, 1),
        TextSize = 14,
        AutoButtonColor = false,
        ClipsDescendants = true,
        LayoutOrder = #parent:GetChildren()
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = btn})
    
    -- Hover effects
    btn.MouseEnter:Connect(function()
        local darken = variant == "Secondary" and 20 or -20
        local color = btn.BackgroundColor3
        Tween(btn, {BackgroundColor3 = Color3.fromRGB(
            math.clamp(color.R * 255 + darken, 0, 255),
            math.clamp(color.G * 255 + darken, 0, 255),
            math.clamp(color.B * 255 + darken, 0, 255)
        )}, 0.2)
    end)
    
    btn.MouseLeave:Connect(function()
        Tween(btn, {BackgroundColor3 = variant == "Secondary" and Theme.Secondary or Theme.Accent}, 0.2)
    end)
    
    btn.MouseButton1Click:Connect(function()
        Ripple(btn, variant == "Secondary" and Color3.new(1,1,1) or Color3.new(0.9, 0.9, 0.9))
        if config.Callback then 
            task.spawn(config.Callback) 
        end
    end)
    
    local buttonObj = {
        Name = name,
        Type = "Button",
        SetVisible = function(self, visible) btn.Visible = visible end
    }
    
    table.insert(self.Elements, buttonObj)
    return buttonObj
end

function AzureUI:CreateInput(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Input"
    local placeholder = config.Placeholder or "Type here..."
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 75),
        LayoutOrder = #parent:GetChildren()
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.6
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15),
        PaddingTop = UDim.new(0, 10),
        PaddingBottom = UDim.new(0, 10)
    })
    
    Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local inputBg = Create("Frame", {
        Parent = container,
        Size = UDim2.new(1, 0, 0, 32),
        Position = UDim2.new(0, 0, 0, 30),
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = 0.5
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = inputBg})
    
    local input = Create("TextBox", {
        Parent = inputBg,
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.Gotham,
        Text = config.Default or "",
        PlaceholderText = placeholder,
        TextColor3 = Theme.Text,
        PlaceholderColor3 = Theme.SubText,
        TextSize = 14,
        ClearTextOnFocus = false
    })
    
    -- Focus effects
    input.Focused:Connect(function()
        Tween(inputBg, {BackgroundTransparency = 0.2}, 0.2)
        Tween(inputBg, {BackgroundColor3 = Theme.ElementBackground}, 0.2)
    end)
    
    input.FocusLost:Connect(function()
        Tween(inputBg, {BackgroundTransparency = 0.5}, 0.2)
        Tween(inputBg, {BackgroundColor3 = Theme.Background}, 0.2)
        if config.Callback then 
            config.Callback(input.Text) 
        end
    end)
    
    local inputObj = {
        Name = name,
        Type = "Input",
        SetVisible = function(self, visible) frame.Visible = visible end,
        Save = function(self) return input.Text end,
        Load = function(self, data) input.Text = data end,
        Set = function(self, text) input.Text = text end,
        Get = function(self) return input.Text end
    }
    
    table.insert(self.Elements, inputObj)
    return inputObj
end

function AzureUI:CreateColorpicker(config)
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Colorpicker"
    local default = config.Default or Color3.fromRGB(255, 255, 255)
    local callback = config.Callback or function() end
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 45),
        LayoutOrder = #parent:GetChildren()
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.6
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15)
    })
    
    Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -60, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local preview = Create("ImageButton", {
        Parent = container,
        Size = UDim2.new(0, 32, 0, 32),
        Position = UDim2.new(1, 0, 0.5, 0),
        AnchorPoint = Vector2.new(1, 0.5),
        BackgroundColor3 = default,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = preview})
    Create("UIStroke", {Parent = preview, Thickness = 2, Color = Theme.Border})
    
    local currentColor = default
    
    preview.MouseButton1Click:Connect(function()
        -- Simple color picker using dialog
        AzureUI:CreateNumberDialog({
            Title = "Color Picker (RGB)",
            Min = 0,
            Max = 255,
            Default = math.floor(currentColor.R * 255)
        }, function(r)
            if r then
                AzureUI:CreateNumberDialog({
                    Title = "Green Value",
                    Min = 0,
                    Max = 255,
                    Default = math.floor(currentColor.G * 255)
                }, function(g)
                    if g then
                        AzureUI:CreateNumberDialog({
                            Title = "Blue Value",
                            Min = 0,
                            Max = 255,
                            Default = math.floor(currentColor.B * 255)
                        }, function(b)
                            if b then
                                currentColor = Color3.fromRGB(r, g, b)
                                preview.BackgroundColor3 = currentColor
                                callback(currentColor)
                            end
                        end)
                    end
                end)
            end
        end)
    end)
    
    local colorObj = {
        Name = name,
        Type = "Colorpicker",
        SetVisible = function(self, visible) frame.Visible = visible end,
        Save = function(self) return {R = currentColor.R, G = currentColor.G, B = currentColor.B} end,
        Load = function(self, data)
            currentColor = Color3.new(data.R, data.G, data.B)
            preview.BackgroundColor3 = currentColor
            callback(currentColor)
        end,
        Set = function(self, color)
            currentColor = color
            preview.BackgroundColor3 = color
            callback(color)
        end
    }
    
    table.insert(self.Elements, colorObj)
    return colorObj
end

function AzureUI:CreateKeybind(config)
    local Window = self.Window or self
    local parent = self.Content or self
    config = config or {}
    local name = config.Name or "Keybind"
    
    local frame = Create("Frame", {
        Parent = parent,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 45),
        LayoutOrder = #parent:GetChildren()
    })
    
    local container = Create("Frame", {
        Parent = frame,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.6
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = container})
    Create("UIPadding", {
        Parent = container,
        PaddingLeft = UDim.new(0, 15),
        PaddingRight = UDim.new(0, 15)
    })
    
    Create("TextLabel", {
        Parent = container,
        BackgroundTransparency = 1,
        Size = UDim2.new(0.6, 0, 1, 0),
        Font = Enum.Font.Gotham,
        Text = name,
        TextColor3 = Theme.Text,
        TextSize = 14,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local keyBtn = Create("TextButton", {
        Parent = container,
        AnchorPoint = Vector2.new(1, 0.5),
        Position = UDim2.new(1, 0, 0.5, 0),
        BackgroundColor3 = Theme.Background,
        Size = UDim2.new(0, 100, 0, 32),
        Font = Enum.Font.GothamBold,
        Text = config.Default and config.Default.Name or "None",
        TextColor3 = Theme.Text,
        TextSize = 12,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = keyBtn})
    Create("UIStroke", {Color = Theme.Accent, Thickness = 1, Transparency = 0.5, Parent = keyBtn})
    
    local currentKey = config.Default
    local listening = false
    
    keyBtn.MouseButton1Click:Connect(function()
        if listening then return end
        listening = true
        keyBtn.Text = "..."
        Tween(keyBtn, {BackgroundColor3 = Theme.Accent}, 0.2)
        
        local connection
        connection = UserInputService.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Keyboard then
                if input.KeyCode == Enum.KeyCode.Escape then
                    keyBtn.Text = currentKey and currentKey.Name or "None"
                    listening = false
                    Tween(keyBtn, {BackgroundColor3 = Theme.Background}, 0.2)
                    if connection then connection:Disconnect() end
                    return
                end
                
                currentKey = input.KeyCode
                keyBtn.Text = currentKey.Name
                listening = false
                Tween(keyBtn, {BackgroundColor3 = Theme.Background}, 0.2)
                
                if connection then connection:Disconnect() end
            end
        end)
    end)
    
    if config.Callback and currentKey then
        table.insert(Window.Keybinds, {
            Name = name,
            Key = currentKey,
            Callback = config.Callback
        })
    end
    
    local keybindObj = {
        Name = name,
        Type = "Keybind",
        SetVisible = function(self, visible) frame.Visible = visible end,
        Save = function(self) return currentKey and currentKey.Name or nil end,
        Load = function(self, keyName)
            if keyName and Enum.KeyCode[keyName] then
                currentKey = Enum.KeyCode[keyName]
                keyBtn.Text = keyName
            end
        end
    }
    
    table.insert(self.Elements, keybindObj)
    return keybindObj
end

-- Global keybind handler
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    -- This would need to be connected to active windows
end)

-- Return library
return AzureUI

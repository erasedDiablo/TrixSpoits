local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Window = Rayfield:CreateWindow({
    Name = "Item Collector",
    LoadingTitle = "Item Collector Script",
    LoadingSubtitle = "by User",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "ItemCollector",
        FileName = "Config"
    }
})

-- Create Tabs
local MainTab = Window:CreateTab("Main", 4483362458)
local PriorityTab = Window:CreateTab("Priority Items", 4483362458)
local SellTab = Window:CreateTab("Sell Items", 4483362458)

-- Configuration Variables
getgenv().BuyLucky = true
getgenv().AutoSell = true
getgenv().Hop = false
getgenv().PriorityItems = {
    "Lucky Arrow",
    "Lucky Stone Mask",
    "Green Candy",
    "Red Candy",
    "Blue Candy",
    "Yellow Candy"
}
getgenv().SellItems = {
    ["Gold Coin"] = true,
    ["Rokakaka"] = true,
    ["Pure Rokakaka"] = true,
    ["Mysterious Arrow"] = true,
    ["Diamond"] = true,
    ["Ancient Scroll"] = true,
    ["Caesar's Headband"] = true,
    ["Stone Mask"] = true,
    ["Rib Cage of The Saint's Corpse"] = true,
    ["Quinton's Glove"] = true,
    ["Zeppeli's Hat"] = true,
    ["Lucky Arrow"] = false,
    ["Lucky Stone Mask"] = false,
    ["Clackers"] = true,
    ["Steel Ball"] = true,
    ["Dio's Diary"] = true,
    ["Green Candy"] = false,
    ["Red Candy"] = false,
    ["Blue Candy"] = false,
    ["Yellow Candy"] = false
}

-- Spawned Items table (used by the collection logic)
getgenv().SpawnedItems = {}

-- ==================== UI CREATION ====================

-- Main Tab
MainTab:CreateSection("Features")

MainTab:CreateToggle({
    Name = "Buy Lucky Arrows",
    CurrentValue = getgenv().BuyLucky,
    Callback = function(Value)
        getgenv().BuyLucky = Value
    end,
    Flag = "BuyLucky"
})

MainTab:CreateToggle({
    Name = "Auto Sell Items",
    CurrentValue = getgenv().AutoSell,
    Callback = function(Value)
        getgenv().AutoSell = Value
    end,
    Flag = "AutoSell"
})

MainTab:CreateToggle({
    Name = "Auto Server Hop",
    CurrentValue = getgenv().Hop,
    Callback = function(Value)
        getgenv().Hop = Value
    end,
    Flag = "Hop"
})

MainTab:CreateSection("Script Control")
MainTab:CreateToggle({
    Name = "Enable Script",
    CurrentValue = false,
    Callback = function(Value)
        getgenv().ScriptRunning = Value
        if Value then
            task.spawn(RunItemCollector)
            Rayfield:Notify({Title = "Script Started", Content = "Item collector is now active", Duration = 3})
        else
            Rayfield:Notify({Title = "Script Stopped", Content = "Item collector has been disabled", Duration = 3})
        end
    end,
    Flag = "EnableScript"
})

-- Priority Items Tab
PriorityTab:CreateSection("Add Item")
PriorityTab:CreateInput({
    Name = "New Item Name",
    PlaceholderText = "Enter item name...",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        if Text ~= "" and not table.find(getgenv().PriorityItems, Text) then
            table.insert(getgenv().PriorityItems, Text)
            Rayfield:Notify({Title = "Success", Content = Text .. " added to priority list", Duration = 3})
        elseif Text ~= "" then
            Rayfield:Notify({Title = "Info", Content = Text .. " is already in priority items", Duration = 3})
        end
    end
})

PriorityTab:CreateSection("Remove Item")
PriorityTab:CreateInput({
    Name = "Item to Remove",
    PlaceholderText = "Enter item name...",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        if Text ~= "" then
            local index = table.find(getgenv().PriorityItems, Text)
            if index then
                table.remove(getgenv().PriorityItems, index)
                Rayfield:Notify({Title = "Success", Content = Text .. " removed from priority list", Duration = 3})
            else
                Rayfield:Notify({Title = "Error", Content = Text .. " not found in priority items", Duration = 3})
            end
        end
    end
})

PriorityTab:CreateSection("Current Items")
PriorityTab:CreateButton({
    Name = "View Priority Items",
    Callback = function()
        local items = table.concat(getgenv().PriorityItems, "\n")
        Rayfield:Notify({Title = "Priority Items", Content = items, Duration = 5})
    end
})

-- Sell Items Tab
SellTab:CreateSection("Item Toggles (Note: Custom items require script restart)")

-- Create toggles for each sellable item
for itemName, shouldSell in pairs(getgenv().SellItems) do
    SellTab:CreateToggle({
        Name = itemName,
        CurrentValue = shouldSell,
        Callback = function(Value)
            getgenv().SellItems[itemName] = Value
        end,
        Flag = "Sell_" .. itemName
    })
end

SellTab:CreateSection("Add Custom Item")
SellTab:CreateInput({
    Name = "Custom Item Name",
    PlaceholderText = "Enter item name...",
    RemoveTextAfterFocusLost = false,
    Callback = function(Text)
        if Text ~= "" and getgenv().SellItems[Text] == nil then
            getgenv().SellItems[Text] = true
            Rayfield:Notify({Title = "Success", Content = Text .. " added to sell items. Restart script to see toggle.", Duration = 3})
        elseif Text ~= "" then
            Rayfield:Notify({Title = "Info", Content = Text .. " already exists", Duration = 3})
        end
    end
})

-- ==================== MAIN SCRIPT LOGIC ====================

function RunItemCollector()
    -- Wait for game to load
    wait(4)

    -- Game services
    local Workspace = game:GetService("Workspace")
    local Players = game:GetService("Players")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RunService = game:GetService("RunService")
    local MarketplaceService = game:GetService("MarketplaceService")
    local TeleportService = game:GetService("TeleportService")

    local Player = Players.LocalPlayer
    local PlayerGui = Player:WaitForChild("PlayerGui")

    -- Error handling to prevent kicks
    game:GetService("CoreGui").DescendantAdded:Connect(function(child)
        if child.Name == "ErrorPrompt" then
            local GrabError = child:FindFirstChild("ErrorMessage", true)
            repeat task.wait() until GrabError.Text ~= "Label"
            local Reason = GrabError.Text
            if Reason:match("kick") or Reason:match("You") or Reason:match("conn") or Reason:match("rejoin") then
                TeleportService:Teleport(2809202155, Player)
            end
        end
    end)

    -- Check for 2x gamepass
    local Has2x = MarketplaceService:UserOwnsGamePassAsync(Player.UserId, 14597778)

    -- Setup item max amounts
    local MaxItemAmounts = {
        ["Gold Coin"] = 45,
        ["Rokakaka"] = 25,
        ["Pure Rokakaka"] = 10,
        ["Mysterious Arrow"] = 25,
        ["Diamond"] = 30,
        ["Ancient Scroll"] = 10,
        ["Caesar's Headband"] = 10,
        ["Stone Mask"] = 10,
        ["Rib Cage of The Saint's Corpse"] = 20,
        ["Quinton's Glove"] = 10,
        ["Zeppeli's Hat"] = 10,
        ["Lucky Arrow"] = 15,
        ["Lucky Stone Mask"] = 10,
        ["Clackers"] = 10,
        ["Steel Ball"] = 10,
        ["Dio's Diary"] = 10,
        ["Green Candy"] = 45,
        ["Red Candy"] = 45,
        ["Blue Candy"] = 45,
        ["Yellow Candy"] = 45
    }

    if Has2x then
        for Index, Max in pairs(MaxItemAmounts) do
            MaxItemAmounts[Index] = Max * 2
        end
    end

    -- Hook magnitude for item collection
    local oldMagnitude
    oldMagnitude = hookmetamethod(Vector3.new(), "__index", newcclosure(function(self, index)
        local CallingScript = tostring(getcallingscript())
        if not checkcaller() and index == "magnitude" and CallingScript == "ItemSpawn" then
            return 0
        end
        return oldMagnitude(self, index)
    end))

    -- Hook namecall for anti-cheat bypass
    local UzuKeeIsRetardedAndDoesntKnowHowToMakeAnAntiCheatOnTheServerSideAlsoVexStfuIKnowTheCodeIsBadYouDontNeedToTellMe = "  ___XP DE KEY"
    local oldNc
    oldNc = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
        local Method = getnamecallmethod()
        local Args = {...}
        if not checkcaller() and rawequal(self.Name, "Returner") and rawequal(Args[1], "idklolbrah2de") then
            return UzuKeeIsRetardedAndDoesntKnowHowToMakeAnAntiCheatOnTheServerSideAlsoVexStfuIKnowTheCodeIsBadYouDontNeedToTellMe
        end
        return oldNc(self, ...)
    end))

    -- Wait for HUD and load screens
    if not PlayerGui:FindFirstChild("HUD") then
        local HUD = ReplicatedStorage.Objects.HUD:Clone()
        HUD.Parent = PlayerGui
    end

    task.spawn(function()
        pcall(function()
            PlayerGui:WaitForChild("LoadingScreen1"):Destroy()
        end)
        task.wait(.5)
        pcall(function()
            PlayerGui:WaitForChild("LoadingScreen"):Destroy()
        end)
        pcall(function()
            workspace.LoadingScreen.Song:Destroy()
        end)
    end)

    -- Wait for character
    repeat task.wait() until Player.Character and Player.Character:FindFirstChild("RemoteEvent") and Player.Character:FindFirstChild("HumanoidRootPart")
    
    local Character = Player.Character
    local HumanoidRootPart = Character.HumanoidRootPart
    local RemoteEvent = Character.RemoteEvent

    -- Press play and teleport
    RemoteEvent:FireServer("PressedPlay")
    wait(1)
    HumanoidRootPart.CFrame = CFrame.new(978, -42, -49)
    wait(5)

    -- Helper functions
    local function GetCharacter(Part)
        if Player.Character then
            if not Part then
                return Player.Character
            elseif typeof(Part) == "string" then
                return Player.Character:FindFirstChild(Part) or nil
            end
        end
        return nil
    end

    local function TeleportTo(Position)
        local HumanoidRootPart = GetCharacter("HumanoidRootPart")
        if HumanoidRootPart then
            local PositionType = typeof(Position)
            if PositionType == "CFrame" then
                HumanoidRootPart.CFrame = Position
            end
        end
    end

    local function ToggleNoclip(Value)
        local Character = GetCharacter()
        if Character then
            for _, Child in pairs(Character:GetDescendants()) do
                if Child:IsA("BasePart") and Child.CanCollide == not Value then
                    Child.CanCollide = Value
                end
            end
        end
    end

    local function HasMaxItem(Item)
        local Count = 0
        for _, Tool in pairs(Player.Backpack:GetChildren()) do
            if Tool.Name == Item then
                Count += 1
            end
        end
        if MaxItemAmounts[Item] then
            return Count >= MaxItemAmounts[Item]
        else
            return false
        end
    end

    local function HasLuckyArrows()
        local Count = 0
        for _, Tool in pairs(Player.Backpack:GetChildren()) do
            if Tool.Name == "Lucky Arrow" then
                Count += 1
            end
        end
        return Count >= 9
    end

    local function IsPriorityItem(ItemName)
        for _, PriorityName in pairs(getgenv().PriorityItems) do
            if ItemName == PriorityName then
                return true
            end
        end
        return false
    end

    local function GetItemInfo(Model)
        if Model and Model:IsA("Model") and Model.Parent and Model.Parent.Name == "Items" then
            local PrimaryPart = Model.PrimaryPart
            if not PrimaryPart then return nil end
            local Position = PrimaryPart.Position
            local ProximityPrompt
            for _, ItemInstance in pairs(Model:GetChildren()) do
                if ItemInstance:IsA("ProximityPrompt") and ItemInstance.MaxActivationDistance == 8 then
                    ProximityPrompt = ItemInstance
                end
            end
            if ProximityPrompt then
                return {
                    ["Name"] = ProximityPrompt.ObjectText,
                    ["ProximityPrompt"] = ProximityPrompt,
                    ["Position"] = Position,
                    ["IsPriority"] = IsPriorityItem(ProximityPrompt.ObjectText)
                }
            end
        end
        return nil
    end

    -- Item spawn tracking
    local ItemSpawnFolder = Workspace:WaitForChild("Item_Spawns"):WaitForChild("Items")
    
    local itemConnection = ItemSpawnFolder.ChildAdded:Connect(function(Model)
        task.wait(1)
        if Model:IsA("Model") then
            local ItemInfo = GetItemInfo(Model)
            if ItemInfo then
                table.insert(getgenv().SpawnedItems, ItemInfo)
            end
        end
    end)

    -- Load teleport function
    local Teleport = loadstring(game:HttpGet("https://raw.githubusercontent.com/rinqedd/pub_rblx/main/ServerHop", true))

    -- Main collection loop
    while getgenv().ScriptRunning do
        if #getgenv().SpawnedItems > 0 then
            -- Sort items by priority
            table.sort(getgenv().SpawnedItems, function(a, b)
                if a.IsPriority and not b.IsPriority then
                    return true
                elseif not a.IsPriority and b.IsPriority then
                    return false
                else
                    return false
                end
            end)

            -- Collect items
            for Index = #getgenv().SpawnedItems, 1, -1 do
                if not getgenv().ScriptRunning then break end
                
                local ItemInfo = getgenv().SpawnedItems[Index]
                local HumanoidRootPart = GetCharacter("HumanoidRootPart")
                
                if HumanoidRootPart and ItemInfo then
                    local Name = ItemInfo.Name
                    local HasMax = HasMaxItem(Name)
                    
                    if not HasMax then
                        local ProximityPrompt = ItemInfo.ProximityPrompt
                        local Position = ItemInfo.Position
                        
                        if ProximityPrompt and ProximityPrompt.Parent then
                            table.remove(getgenv().SpawnedItems, Index)
                            
                            local BodyVelocity = Instance.new("BodyVelocity")
                            BodyVelocity.Parent = HumanoidRootPart
                            BodyVelocity.Velocity = Vector3.new(0, 0, 0)
                            BodyVelocity.MaxForce = Vector3.new(100000, 100000, 100000)
                            
                            ToggleNoclip(true)
                            TeleportTo(CFrame.new(Position.X, Position.Y + 25, Position.Z))
                            task.wait(.5)
                            
                            pcall(function()
                                fireproximityprompt(ProximityPrompt)
                            end)
                            
                            task.wait(.5)
                            BodyVelocity:Destroy()
                            ToggleNoclip(false)
                            TeleportTo(CFrame.new(978, -42, -49))
                        else
                            table.remove(getgenv().SpawnedItems, Index)
                        end
                    else
                        table.remove(getgenv().SpawnedItems, Index)
                    end
                end
            end
        end

        -- Auto sell items
        if #getgenv().SpawnedItems == 0 and getgenv().AutoSell and getgenv().ScriptRunning then
            for Item, Sell in pairs(getgenv().SellItems) do
                if Sell and Player.Backpack and Player.Backpack:FindFirstChild(Item) then
                    local Character = GetCharacter()
                    if Character and Character:FindFirstChild("Humanoid") and Character:FindFirstChild("RemoteEvent") then
                        Character.Humanoid:EquipTool(Player.Backpack:FindFirstChild(Item))
                        task.wait(.1)
                        Character.RemoteEvent:FireServer("EndDialogue", {
                            ["NPC"] = "Merchant",
                            ["Dialogue"] = "Dialogue5",
                            ["Option"] = "Option2"
                        })
                        task.wait(.2)
                    end
                end
            end
        end

        -- Buy lucky arrows
        local Money = Player.PlayerStats.Money
        if getgenv().BuyLucky and not HasLuckyArrows() and Money.Value >= 75000 and getgenv().ScriptRunning then
            while Money.Value >= 75000 and getgenv().ScriptRunning do
                local Character = GetCharacter()
                if Character and Character:FindFirstChild("RemoteEvent") then
                    Character.RemoteEvent:FireServer("PurchaseShopItem", {["ItemName"] = "1x Lucky Arrow"})
                    task.wait(.1)
                else
                    break
                end
            end
        end

        -- Server hop
        if getgenv().Hop and #getgenv().SpawnedItems == 0 and getgenv().ScriptRunning then
            local ShouldHop = true
            if getgenv().BuyLucky and not HasLuckyArrows() and Money.Value >= 50000 then
                ShouldHop = false
            end
            
            if ShouldHop then
                pcall(function()
                    Teleport()
                end)
                task.wait(3)
            else
                task.wait(5)
            end
        else
            task.wait(#getgenv().SpawnedItems > 0 and 1 or 5)
        end
    end

    -- Cleanup when script stops
    if itemConnection then
        itemConnection:Disconnect()
    end
end

-- Show welcome notification
Rayfield:Notify({
    Title = "Script Loaded",
    Content = "Configure settings and enable the script to start",
    Duration = 5
})

--идите в пизду мне лень чёт делать так что вот апдейт хуйни на юбу и кст мать парагона жирная шлюха - heny
